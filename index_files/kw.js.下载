function _instance(obj,callback){var fun=obj.substring(0,1).toUpperCase()+"KW_"+obj.substring(1,obj.length).toLowerCase();var fun=fun.replace(RegExp("[.]","g"),'_');function load_js(succ,fail){if(eval('typeof '+fun)!='function'){var module=obj.substring(1,obj.length).toLowerCase().split(".")[0];kw_load_js(module+'.js',function(){if(eval('typeof '+fun)=='function'){(typeof succ=='function')&&succ.apply()}else{(typeof fail=='function')&&fail.apply()}},function(){(typeof fail=='function')&&fail.apply()})}else{(typeof succ=='function')&&succ.apply()}};load_js(function(){var n=obj.split('.');var o='',f='';for(var i=0;i<n.length;i++){o+=(o?'.':'')+n[i];if(eval('typeof '+o)=='undefined'){f=o.substring(0,1).toUpperCase()+"KW_"+o.substring(1,o.length).toLowerCase();f=f.replace(RegExp("[.]","g"),'_');(window.execScript||function(data){window["eval"].call(window,data)})(o+' =new '+f+'()')}}try{(typeof callback=='function')&&callback.apply()}catch(e){alert(e)}},function(){alert('模块['+obj+"]加载失败！")})};function kw_load_js(path,succ,fail){var id="load_js_"+kw_md5(path);if(document.getElementById(id)){(typeof succ=='function')&&succ.call()}else{var s=document.createElement("script");s.id=id;s.type="text/javascript";s.onload=s.onreadystatechange=function(){if(s.readyState&&s.readyState!='loaded'&&s.readyState!='complete'){return}s.onreadystatechange=s.onload=null;(typeof succ=='function')&&succ.call()};if(typeof fail=='function')s.onerror=fail;s.src='./'+HAr.get(window.KW_CONFIG,['path'],'kwjs/')+path;document.getElementsByTagName('HEAD').item(0).appendChild(s)}};function kw_tpl(path,data,callback){if(!window.KW_TPL_STORE){window.KW_TPL_STORE={}}if(window.KW_TPL_STORE[path]){run(window.KW_TPL_STORE[path])}else{$.ajax({'url':'./'+HAr.get(window.KW_CONFIG,['path'],'kwjs/')+'tpl/'+path,'success':function(tpl){window.KW_TPL_STORE[path]=tpl;run(tpl)},'contentType':'text','dataType':'text'})}function run(tpl){var html;window.function_afeter_view_load=[];if(data&&typeof data=='object'){html=_.template(tpl,data)}else{html=tpl}(typeof callback=='function')&&callback.apply(null,[html]);window.function_afeter_view_load.forEach(function(fr){fr[0].apply(null,fr[1])})}};function kw_view_function(fn,para){var cls=HTxt.make_random();para=para||[];para.push(cls);window.function_afeter_view_load.push([fn,para]);return cls};function kw_touched(obj){var $o=obj||$(this);$o.addClass('touched');setTimeout(function(){$o.removeClass('touched')},400)};function kw_delay_remove(cls,t){var $o=$(this);$o.addClass(cls);setTimeout(function(){$o.removeClass(cls)},t?t:400)};function kw_delay_add(cls,t){var $o=$(this);setTimeout(function(){$o.addClass(cls)},t?t:100)};function kw_usedefimg(defimg){if(!$(this).data('imgerror')){this.src=defimg;$(this).data('imgerror',1)}};function kw_go(para){var c=para.c;var a=para.a;_instance(c,function(){window.scroll(0,0);var fun=eval(c+"."+a);fun.apply(null,[para])})};function kw_url_push(para){(!window.KW_URL_LOG)&&(window.KW_URL_LOG=[]);window.KW_URL_LOG.push(para)};function kw_url_back(){(!window.KW_URL_LOG)&&(window.KW_URL_LOG=[]);var now=window.KW_URL_LOG.pop();var pre=window.KW_URL_LOG.pop();if(now&&!pre){window.KW_URL_LOG.push(now)}if(pre&&pre.c){kw_go(pre);return true}else{window.plugins.CLAppTools.exit();return false}};function kw_gohome(){window.plugins.CLAppTools.exit()};function kw_tojson(object){if(object===null){return'""'}var type=typeof object;if('object'==type){if(Array==object.constructor)type='array';else if(RegExp==object.constructor)type='regexp';else type='object'}switch(type){case'undefined':case'unknown':return;break;case'function':case'boolean':case'regexp':return object.toString();break;case'number':return isFinite(object)?object.toString():'null';break;case'string':return'"'+object.replace(/(\\|\")/g,"\\$1").replace(/\n|\r|\t/g,function(){var a=arguments[0];return(a=='\n')?'\\n':(a=='\r')?'\\r':(a=='\t')?'\\t':""})+'"';break;case'object':if(object===null)return'null';var results=[];for(var property in object){var value=kw_tojson(object[property]);if(value!==undefined)results.push(kw_tojson(property)+':'+value)}return'{'+results.join(',')+'}';break;case'array':var results=[];for(var i=0;i<object.length;i++){var value=kw_tojson(object[i]);if(value!==undefined)results.push(value)}return'['+results.join(',')+']';break}};function kw_post(original_url,getPara,postData,success,fail){var api_url=original_url.replace(/\$[a-zA-Z]+\^/g,function(w){var k=w.replace(/\$|\^/g,'');return getPara[k]?getPara[k]:''});return $.ajax({url:api_url,data:$.param(postData),success:function(data){(typeof success=='function')&&success(data)},error:function(message){(typeof fail=='function')&&fail(message)},complete:function(XMLHttpRequest,textStatus){},type:"post",timeout:15*1000,dataType:"json"})};function kw_md5(_string){var rotateLeft=function(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits))};var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8)}else{return(lResult^lX8^lY8)}};var F=function(x,y,z){return(x&y)|((~x)&z)};var G=function(x,y,z){return(x&z)|(y&(~z))};var H=function(x,y,z){return(x^y^z)};var I=function(x,y,z){return(y^(x|(~z)))};var FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var convertToWordArray=function(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWordsTempOne=lMessageLength+8;var lNumberOfWordsTempTwo=(lNumberOfWordsTempOne-(lNumberOfWordsTempOne%64))/64;var lNumberOfWords=(lNumberOfWordsTempTwo+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++}lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray};var wordToHex=function(lValue){var WordToHexValue="",WordToHexValueTemp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValueTemp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValueTemp.substr(WordToHexValueTemp.length-2,2)}return WordToHexValue};var uTF8Encode=function(string){string=string.replace(new RegExp("\x0d\x0a","g"),"\x0a");var output="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){output+=String.fromCharCode(c)}else if((c>127)&&(c<2048)){output+=String.fromCharCode((c>>6)|192);output+=String.fromCharCode((c&63)|128)}else{output+=String.fromCharCode((c>>12)|224);output+=String.fromCharCode(((c>>6)&63)|128);output+=String.fromCharCode((c&63)|128)}}return output};var md5=function(string){var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=uTF8Encode(string);x=convertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD)}var tempValue=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return tempValue.toLowerCase()};return md5(_string)}function kw_api(url_sets,get,post,succ,fail){var type=url_sets[0];var url=url_sets[1];switch(type){case'info':url=url.replace('?q=json/','json/');url=url.replace('&info=','/_info_/');url+='.api';kw_post(window.config.apiUrl+url,get,post,succ,fail);break;case'dist':kw_post(window.config.apiUrl.replace('/api/','/api_dist/')+url,get,post,succ,fail);break;default:kw_post(window.config.apiUrl+url,get,post,succ,fail)}}HAr=new function(){var me=this;this.get=function(ar,key,def){ar=ar||'';def=def||'';$.each(key,function(i,k){if(ar[k]){ar=ar[k]}else{ar=def;return false}});return ar===false?def:ar};this.rebuild=function(res,key,type){var ret;if(type=='row'){ret={};$.each(res,function(i,r){ret[r[key]]=r})}else if(type=='group'){ret={};$.each(res,function(i,r){(!ret[r[key]])&&(ret[r[key]]=[]);ret[r[key]].push(r)})}else if(typeof key=="object"){ret={};$.each(res,function(i,r){ret[r[key[0]]]=r[key[1]]})}else{ret=[];$.each(res,function(i,r){ret.push(r[key])})}return ret};this.by=function(name){return function(o,p){var a,b;if(typeof o==="object"&&typeof p==="object"&&o&&p){a=o[name];b=p[name];if(a===b){return 0}if(typeof a===typeof b){return a<b?-1:1}return typeof a<typeof b?-1:1}else{throw("error")}}}};window.HNotify=new function(){var me=this;this.info_store=[];this.toast_timer="";this.dialogZ=20000;this.toast=function(text,tl){if(navigator.app){window.plugins.CLAppTools.toast(text,tl)}else{this.info_store.push(text);if(!this.toast_timer)this.showtoast()}};this.showtoast=function(){if(this.info_store.length==0){this.toast_timer="";return}else{$("body").append("<div id='pctoast'><span id='pctoastinfo'>"+this.info_store.shift()+"</span></div>");$("#pctoast").addClass("pctoast");this.toast_timer=setTimeout("$('#pctoast').remove();window.HNotify.showtoast()",2000)}};this.alert=function(content,title,callback,button_str){if(navigator.notification){navigator.notification.alert(content,callback||null,title||'提示！',button_str||'确定')}else{kw_tpl("notify/alert.tpl.html",null,function(html_east){var dom=me.strToDom(html_east);document.getElementsByTagName("body")[0].appendChild(dom);var jDom=$(dom);jDom.find("li").eq(0).html(title||'提示！');jDom.find("li").eq(1).html(content);jDom.find("input").eq(0).val(button_str||'确定');jDom.find("input").eq(0).bind("click",function(){jDom.remove()});jDom.find("input").eq(0).bind("click",callback||null);me.dialogZ-=1;jDom.css("z-index",me.dialogZ);jDom.show()})}};this.strToDom=function(str){var Dom=document.createElement("div");Dom.innerHTML=str;return Dom.childNodes[0]};this.confirm=function(content,fun_clkbtn2,title,btns){if(navigator.notification){navigator.notification.confirm(content,function(index){index==2&&(typeof fun_clkbtn2=='function')&&fun_clkbtn2.apply()},title||'提示！',btns||'取消,确定')}else{kw_tpl("notify/confirm.tpl.html",null,function(html_east){var dom=me.strToDom(html_east);document.getElementsByTagName("body")[0].appendChild(dom);var jDom=$(dom);jDom.find("li").eq(0).html(title||'提示！');jDom.find("li").eq(1).html(content);jDom.find("input").eq(0).val((btns||'取消,确定').split(",")[0]);jDom.find("input").eq(1).val((btns||'取消,确定').split(",")[1]);jDom.find("input").eq(0).bind("click",function(){jDom.remove()});jDom.find("input").eq(1).bind("click",function(){jDom.remove()});jDom.find("input").eq(1).bind("click",fun_clkbtn2||null);me.dialogZ-=1;jDom.css("z-index",me.dialogZ);jDom.show()})}}};var HTime=new function(){var me=this;this.d=[];this.trim=function(datetime){if(typeof datetime!="string"){return""}var p=new RegExp(/^((\d{4})([-\/]\d{1,2}){2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/);var m=datetime.match(p);if(m==null){return''}var d=new Date(m[1]);if(d.toString()=='Invalid Date'){return''}if(parseInt(m[4])>23){return''}if(parseInt(m[5])>59){return''}if(parseInt(m[6])>59){return''}return datetime};this.str2date=function(str_datetime){if(typeof str_datetime!="string"){return false}var p=new RegExp(/^((\d{4})(-|\/)(\d{1,2})(-|\/)(\d{1,2})) (\d{1,2}):(\d{1,2}):(\d{1,2})$/);var m=str_datetime.match(p);if(m==null){return false}var d=new Date(m[1]);if(d.toString()=='Invalid Date'){return false}if(parseInt(m[7])>23||parseInt(m[8])>59||parseInt(m[9])>59){return false}var d=new Date(m[2],m[4],m[6],m[7],m[8],m[9]);return d};this.diff=function(starttime,endtime){if(starttime instanceof Date){var s=starttime}else if(typeof starttime=='string'){var s=me.str2date(starttime)}if(endtime instanceof Date){var e=endtime}else if(typeof endtime=='string'){var e=me.str2date(endtime)}if(!s||!e){return{'starttime':s,'endtime':e,'diff':false}}return{'starttime':s,'endtime':e,'diff':e-s}};this.date=function(){var d=new Date();Y=d.getFullYear();M=HTxt.add2pre(d.getMonth()+1,'0',2);D=HTxt.add2pre(d.getDate(),'0',2);var hh=HTxt.add2pre(d.getHours(),'0',2);var mm=HTxt.add2pre(d.getMinutes(),'0',2);var ss=d.getTime()%60000;ss=HTxt.add2pre((ss-(ss%1000))/1000,'0',2);return Y+'-'+M+'-'+D+' '+hh+":"+mm+":"+ss};this.getTime=function(){var a=new Date();return a.getTime()};this.intsec2clock=function(pos){return HTxt.add2pre(Math.floor(parseInt(pos)/60),'0',2)+":"+HTxt.add2pre(parseInt(pos)%60,'0',2)};this.set=function(flag,log_type){var date=new Date();me.d[me.d.length]={'flag':flag,'time':date.getTime()};if(me.d.length>1){var t=date.getTime()-me.d[me.d.length-2].time;var str="time from "+me.d[me.d.length-2].flag+" to "+flag+"="+t+" (m)";if(log_type=='console'){window.console.log("timeflag "+flag+"="+date.getTime());window.console.log(str)}else if(log_type=='alert'){alert(t)}return t};return''}};var HTxt=new function(){var me=this;this.make_random=function(){return'c'+Math.random().toString().replace('0.','')};this.repeat=function(x,n){var txt='';x+='';for(var i=0;i<n;i++){txt+=x}return txt};this.add2pre=function(x,c,len){x+='';if(x.length<len){x=me.repeat(c,len-x.length)+x};return x};this.trim=function(x){return x.replace(/(^\s*)|(\s*$)/g,"")};this.check_chinese=function(x){return(new RegExp("[\u4E00-\u9FA5]|[\uFE30-\uFFA0]")).test(x)};this.str_width=function(x,fsize){var cl=x.replace(new RegExp("[\u4E00-\u9FA5]|[\uFE30-\uFFA0]","g"),'**').length-x.length;var el=x.length-ch_len;return(cl*2+el)*fsize/2}};var HEvent=new function(){var me=this;this.p=0;this.s=0;this.n=0;this.d={};this.m={};this.tpl_timer=0;this.target_start=null;this.all_type=['_tp','_tmv','_tup','_tk','_tpl','_left','_up','_down','_right','_dfail'];this.fns_mv={};this.fns_up={};this.touchstart=function(event){if(event.button&&event.button>0)return;var a=new Date();me.s=a.getTime();me.p=1;document.ontouchstart&&(me.d={pageX:event.targetTouches[0].pageX,pageY:event.targetTouches[0].pageY});!document.ontouchstart&&(me.d={pageX:event.pageX,pageY:event.pageY});me.m=me.d;me.target_start=event.target;me.run(event,['_tp'],1)};this.touchmove=function(event){if(event.button&&event.button>0)return;if(!me.p){return}document.ontouchstart&&(me.m={'pageX':event.targetTouches[0].pageX,'pageY':event.targetTouches[0].pageY});!document.ontouchstart&&(me.m={'pageX':event.pageX,'pageY':event.pageY});me.run(event,['_tmv']);for(i in me.fns_mv){typeof me.fns_mv[i]=='function'&&me.fns_mv[i](event)}};this.touchend=function(event){for(i in me.fns_up){typeof me.fns_up[i]=='function'&&me.fns_up[i](event)}if(event.button&&event.button>0)return;me.p=0;var a=new Date();me.n=a.getTime();if(me.n-me.s<600&&me.length_dm()<=20){me.run(event,['_tup','_tk'],2)}else{me.run(event,['_tup'],2)}me.direct(event)};this.run=function(event,fns,tpl_type){var i,obj=event.target,tpl_funs=[];do{if(!obj||!obj.tagName){break}for(i in fns){if(obj.attributes[fns[i]]&&obj.attributes[fns[i]].nodeValue){try{(function(event){eval(obj.attributes[fns[i]].nodeValue)}).apply(obj,[event])}catch(e){alert(e)}}if(me.tag_fns[obj.tagName.toUpperCase()]&&me.tag_fns[obj.tagName.toUpperCase()][fns[i]]){try{me.tag_fns[obj.tagName.toUpperCase()][fns[i]].apply(obj,[event])}catch(e){alert(e)}}}if(tpl_type==1){if(obj.attributes['_tpl']&&obj.attributes['_tpl'].nodeValue){tpl_funs.push({'dom':obj,'code':obj.attributes['_tpl'].nodeValue})}if(me.tag_fns[obj.tagName.toUpperCase()]&&me.tag_fns[obj.tagName.toUpperCase()]['_tpl']){tpl_funs.push({'dom':obj,'code':me.tag_fns[obj.tagName.toUpperCase()]['_tpl']})}}if(obj.attributes._prevent||'BODY'==obj.tagName.toUpperCase()){break}obj=obj.parentNode}while(1);if(tpl_type==1&&tpl_funs.length){me.tpl_timer=setTimeout(function(){me.tpl_timer=0;if(me.length_dm()<20){for(i in tpl_funs){try{(function(){if(typeof tpl_funs[i]['code']=="function"){tpl_funs[i]['code'].apply(this)}else{eval(tpl_funs[i]['code'])}}).apply(tpl_funs[i]['dom'])}catch(e){alert(e)}}}},1200)}(tpl_type==2)&&me.tpl_timer&&clearTimeout(me.tpl_timer)};this.direct=function(event){var s_objs=[],obj;var direct=me.direct_check();obj=me.target_start;do{if(!obj||!obj.tagName){break}s_objs.push(obj);if(obj.attributes._prevent||'BODY'==obj.tagName.toUpperCase()){break}obj=obj.parentNode}while(1);obj=event.target;do{if(!obj||!obj.tagName){break}if(me.inArray(obj,s_objs)>=0){if(obj.attributes[direct]&&obj.attributes[direct].nodeValue){try{(function(event){eval(obj.attributes[direct].nodeValue)}).apply(obj,[event])}catch(e){alert(e)}}}if(obj.attributes._prevent||'BODY'==obj.tagName.toUpperCase()){break}obj=obj.parentNode}while(1)};this.direct_check=function(){$direct="_dfail";var x=me.m.pageX-me.d.pageX;var y=me.m.pageY-me.d.pageY;if(Math.abs(x/y)>1.5){(x>80)&&($direct="_right");(x<-80)&&($direct="_left")}else if(Math.abs(y/x)>1.5){(y>80)&&($direct="_down");(y<-80)&&($direct="_up")}return $direct};this.tag_fns={'KWW':{'_tk':function(event){CArt.wcircle.base_mean.apply(this)}}};this.length_dm=function(){var x=Math.abs(me.d.pageX-me.m.pageX);var y=Math.abs(me.d.pageY-me.m.pageY);return Math.sqrt(x*x+y*y)};this.inArray=function(o,h){var ret=-1;$.each(h,function(i,v){if(v==o){ret=i;return false}});return ret}};window.KW_chart=new function(){var me=this;this.draw_column_2D=function(render,data,clickitem,w,h){var chart=new iChart.Column2D({render:render,data:data,border:{enable:false},title:'全班数据统计',decimalsnum:2,width:w||1000,height:h||500,column_width:50,coordinate:{background_color:'#fefefe',scale:[{position:'left',start_scale:0,end_scale:40,listeners:{parseText:function(t,x,y){return{text:t+((data[0]["unit"])?(data[0]["unit"]):"%")}}}}]},sub_option:{listeners:{parseText:function(r,t){return(data[r.get("id")].othervalue&&data[r.get("id")].othervalue!="")?data[r.get("id")].othervalue:(t+"%")},click:function(d,e,m){clickitem&&clickitem.apply(null,[data[d.get("id")].callback_para||""])}}}});chart.draw();return chart};this.draw_pie_3D=function(render,data,clickitem){var chart=new iChart.Pie3D({render:render,data:data,sub_option:{mini_label_threshold_angle:40,mini_label:{fontsize:15,fontweight:600,color:'#ffffff'},label:{background_color:null,sign:false,padding:'0 5',border:{enable:false,color:'#666666'},fontsize:15,fontweight:600,color:'#4572a7'},border:{enable:false},listeners:{parseText:function(d,t){return d.get('name')},click:function(d,e,m){clickitem&&clickitem.apply(null,[data[d.get("id")].callback_para||""])}}},offsetx:-50,width:500,height:400,border:{enable:false},radius:100,mutex:true});chart.draw()};this.draw_table=function(render,data){var new_data=[];if(data.length>4){var cdata=[];for(var i=0;i<data.length;i++){cdata.push(data[i]);if((i+1)%4==0){new_data.push(cdata);cdata=[]}}}else{new_data.push(data)}kw_tpl("tongji/chart/table.tpl.html",{"data":new_data},function(html_str){$("#"+render).html(html_str);$(".table_table tr").each(function(){var width=100/$(this).find("td").size();$(this).find("td").each(function(){$(this).css("width",width+"%")})})})}};var FApp={"domain_list":{"1":"dev.anoah.com","2":"test.anoah.com","3":"t.anoah.com","4":"anoah.com"}};var FConfig=new function(){this.api_type=0;this.app_key="com.anoah.app.TracedWord";this.db_name="TracedWord";this.sqlite_sim="http://192.168.1.102:508/kwjs/makeback/sqlitesim.php?a=$a^&sql=$sql^&dbname="+"E:/document/weblite通用化/CLCore/数据库/TracedWord.db";this.api_sim="http://192.168.47.211:8080/TestIComWeb/api/?isdebug=true&apiversion=1&q=$api_name^&info=$info^";this.domain_type=3;this.db_version="1.0.0";this.api_version="1";this.w=1024;this.h=602};var DApp=new function(){var me=this;this.user_info={};this.class_info={};this.publish_id=null;this.hour_id=null;this.chapterid=null;this.started=false;this.toolbar_pos='right';this.ebook_exist=null};$(function(){_instance('CTool',function(){CTool.init()});document.addEventListener('mousedown',HEvent.touchstart,true);document.addEventListener('mousemove',HEvent.touchmove,true);document.addEventListener('mouseup',HEvent.touchend,true);window.addEventListener('message',function(evt){if(typeof evt.data=='string'){var d='empty';try{d=$.parseJSON(evt.data)}catch(e){}if(d!='empty'){CTool.c.bloswx.message(d)}}},false);window.onresize=CTool.show_btns});var LQti=new function(){var me=this;this.change_style_timer=0;this.load_qti=function(obj){var options_new={containerId:obj.id,param:{icom_id:obj.icom_id,dcom_entity:obj.dcom_entity,height:obj.height,setting:{caller:'HUDONGCLASS'}}};me.change_style_timer=setInterval(me.change_qit_style,500);window.icomLoadAdapter.load(options_new)};this.change_qit_style=function(){if($(".mainqtidiv").length>0){$(".mainqtidiv").css("border","none");clearInterval(me.change_style_timer)}else{return}};this.start_atqti=function(para,callback){if(!window.icomLoadAdapter){jQuery.getScript("http://u.dev.anoah.com/icoms/qtidiv/icoms/icomLoadAdapter.js",function(){if(window.icomLoadAdapter){run()}else{alert('qti适配器加载失败！')}})}else{run()}function run(){var obj={},dcom_entity="";if(para.id_list){var qti_h=360;for(var i=0;i<para.id_list.length;i++){dcom_entity='question:'+para.id_list[i];obj={id:para.container,icom_id:4629,dcom_entity:dcom_entity,fromBook:true,height:qti_h};me.load_qti(obj,callback)}}}}};
function CKW_classstat_api(){var me=this;this.urls={"class_tj":['info','?q=json/ebag/mutualstat/getDetail&info=$info^']};this.get_classstat_info=function(para,callback){var info={"course_hour_id":para["course_hour_id"]};kw_api(me.urls['class_tj'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得课堂统计数据失败')})}}function CKW_classstat(){var me=this;this.on=function(){_instance("CClassstat.api")};this.start=function(para){me.on();CTool.sw('classstat',para["para"],function(dom){CClassstat.api.get_classstat_info(para["para"],function(data){data["class_name"]=DApp.class_info.class_name;data["grade"]=DApp.class_info.grade_name;kw_tpl("tongji/classstat.tpl.html",data,function(html){dom.html(html)})})})}}function CKW_effectreading_a(){var me=this;this.get_read_speed=function(para){CTool.sw('effectreading',{'model':0,'para':para},function(dom){CEffectreading.api.read_speed(para,function(data){kw_tpl("effectreading/read_speed.tpl.html",data,function(html){dom.html(html)})})})};this.get_read_tongji=function(para){CTool.sw('effectreading',{'model':1,'para':para},function(dom){CEffectreading.api.read_tongji(para,function(data){kw_tpl("tongji/tongji_all.tpl.html",data,function(html){dom.html(html)})})})};this.get_total_tongji=function(para){CTool.sw('effectreading',{'model':1,'para':para},function(dom){CEffectreading.api.total_tongji(para,function(data){kw_tpl("tongji/tongji_all.tpl.html",data,function(html){dom.html(html)})})})}}function CKW_effectreading_api(){var me=this;this.urls={"read_speed":window.config.apiUrl+"?q=json/ebag/mutualstat/getXXX&info={}","read_tongji":window.config.apiUrl+"?q=json/ebag/mutualstat/getXXX&info={}","total_tongji":window.config.apiUrl+"?q=json/ebag/mutualstat/getXXX&info={}"};this.read_speed=function(para,callback){var paras=kw_tojson({"course_resource_id":para.course_resource_id,"dcom_entity_id":para.dcom_entity_id});$.get(me.urls["read_speed"].replace("{}",paras),{},function(data){callback&&callback.apply(null,[data["recordset"]])},"json")};this.read_tongji=function(para,callback){var paras=kw_tojson({"course_resource_id":para.course_resource_id,"dcom_entity_id":para.dcom_entity_id});$.get(me.urls["read_tongji"].replace("{}",paras),{},function(data){callback&&callback.apply(null,[data["recordset"]])},"json")};this.total_tongji=function(para,callback){var paras=kw_tojson({"course_resource_id":para.course_resource_id,"dcom_entity_id":para.dcom_entity_id});$.get(me.urls["total_tongji"].replace("{}",paras),{},function(data){callback&&callback.apply(null,[data["recordset"]])},"json")}}function CKW_effectreading_insidechg(){var me=this;this.get_read_speed=function(para){CTool.sw('effectreading',{'model':0,'para':para},function(dom){CEffectreading.api.read_speed(para,function(data){kw_tpl("effectreading/read_speed.tpl.html",data,function(html){dom.html(html)})})})};this.get_read_tongji=function(para){CTool.sw('effectreading',{'model':1,'para':para},function(dom){CEffectreading.api.read_tongji(para,function(data){kw_tpl("tongji/tongji_all.tpl.html",data,function(html){dom.html(html)})})})};this.get_total_tongji=function(para){CTool.sw('effectreading',{'model':1,'para':para},function(dom){CEffectreading.api.total_tongji(para,function(data){kw_tpl("tongji/tongji_all.tpl.html",data,function(html){dom.html(html)})})})}}function CKW_effectreading(){var me=this;this.on=function(){};this.start_speed=function(){}}function CKW_notclose_a(){var me=this;this.on_continue_class=function(index){var row=CNotclose.d.all_notclose_data[index];var course_hour_publish_id=row.course_hour_publish_id;var course_hour_id=row.course_hour_id;var recover_params=row.recover_params;seajs.use(['modules/command'],function(command){command.classesBegin(course_hour_publish_id,function(){$('.dialog-base').attr('_tk',$('.dialog-base').attr('tmp_tk')).removeAttr('tmp_tk').removeClass('dialog-mask-white dialog-mask-black').empty();DApp.started=true;DApp.publish_id=course_hour_publish_id;var err=0;try{var res=$.parseJSON(recover_params)}catch(e){err=1;CTool.c.reslist.go({'hour_id':course_hour_id})}if(err==0){var STACK_BACKS=HAr.get(res,['STACK_BACKS']);var param=HAr.get(res,['params']);var type=HAr.get(res,['type']);if(typeof HAr.get(CTool.c,[type,'go'])=='function'){CTool.d.STACK_BACKS=STACK_BACKS;HAr.get(CTool.c,[type,'go'])(param,true)}else{CTool.c.reslist.go({'hour_id':course_hour_id})}}})})};this.on_end_class=function(course_hour_publish_id){seajs.use('modules/command',function(command){command.classesEnd(course_hour_publish_id,function(){CNotclose.index()})})};this.on_close=function(){$('.dialog-base').attr('_tk',$('.dialog-base').attr('tmp_tk')).removeAttr('tmp_tk').removeClass('dialog-mask-white dialog-mask-black').empty();CTool.c.reslist.go({})}}function CKW_notclose_api(){var me=this;this.urls={'getAllNoClassPublish':['info','?q=json/ebag/mutual/getAllNoClassPublish&info=$info^']};this.get_notclose_data=function(class_id,course_id,userid,succ){var info={"class_id":class_id,"course_id":course_id,"userid":userid};kw_api(me.urls['getAllNoClassPublish'],{'info':kw_tojson(info)},{},function(j){if(j.recordset){CNotclose.d.all_notclose_data=j.recordset;typeof succ=='function'&&succ()}else{CNotclose.d.all_notclose_data=[];alert('取未结束上课数据时，接口返回数据中recordset格式错误！');typeof succ=='function'&&succ()}},function(){alert('取未结束上课数据失败！')})}}function CKW_notclose_d(){var me=this;this.all_notclose_data=[]}function CKW_notclose(){var me=this;this.on=function(){_instance("CNotclose.a");_instance("CNotclose.d");_instance("CNotclose.api")};this.index=function(){me.on();CNotclose.api.get_notclose_data(DApp.class_info.class_id,DApp.class_info.course_id,DApp.user_info.userid,function(){$('#full_container').empty().hide();if(CNotclose.d.all_notclose_data.length){kw_tpl('notclose/index.tpl.html',{'dlist':CNotclose.d.all_notclose_data},function(html){$('.dialog-base').attr('tmp_tk',$('.dialog-base').attr('_tk')).removeAttr('_tk').html(html).addClass('dialog-mask-black')})}else{if($('.dialog-base').attr('tmp_tk')){$('.dialog-base').attr('_tk',$('.dialog-base').attr('tmp_tk')).removeAttr('tmp_tk').removeClass('dialog-mask-white dialog-mask-black').empty()}CTool.c.reslist.go({})}})}}function CKW_reslist_a(){var me=this;this.ids={"course_id":"1","course_hour_id":"1","edu_book_id":"35066","edu_chapter_id":"2758","edu_subject_id":4,"class_id":1000204,"user_id":0};this.get_part_info=function(){$("#chapter_name").html(CReslist.d.get_chapter_name());$("#course_hour_name").html(CReslist.d.get_course_name());$('.dialog-base').html(CReslist.d.get_all_chapter());CReslist.api.get_index_info(me.ids,function(data){CReslist.d.resource_list=data["resource_list"];CReslist.api.set_cours_chapter_hour(me.ids);kw_tpl("reslist/reslist.tpl.html",{'list':data["resource_list"]},function(html){$("#resource_list").html(html)})})};this.show_chapter_list=function(){if(DApp.started){$('.dialog-base').removeClass('dialog-mask-white dialog-mask-black');return}if(CReslist.d.get_all_chapter()!==""){$('.dialog-base').html(CReslist.d.get_all_chapter()).addClass('dialog-mask-white');return}$('.dialog-base').empty().addClass('dialog-mask-white');CReslist.api.get_book_chapter(me.ids,function(data){kw_tpl("reslist/chapter_list.tpl.html",{"list":data},function(html){$('.dialog-base').html(html);CReslist.d.set_all_chapter(html)})})};this.show_section_list=function(chapterid,chaptername){me.ids["edu_chapter_id"]=chapterid;CReslist.api.get_book_period(me.ids,function(data){kw_tpl("reslist/section_list.tpl.html",{"list":data,"chapterid":chapterid,"chaptername":chaptername},function(html){$('.dialog-base').html(html)})})};this.sel_section=function(chapterid,hourid,chaptername,hourname){CReslist.d.set_chapter_name(chaptername);CReslist.d.set_course_name(hourname);me.ids["course_hour_id"]=hourid;me.ids["edu_chapter_id"]=chapterid;DApp.hour_id=hourid;DApp.chapterid=chapterid;me.get_part_info();$('.dialog-base').removeClass('dialog-mask-white')}}function CKW_reslist_api(){var me=this;this.urls={'get_index_info':['info','?q=json/ebag/mutual/readResource&info=$info^'],'get_book_chapter':['info','?q=json/Edu/Chapter/readChapter&info=$info^'],'get_book_period':['info','?q=json/ebag/mutual/getCourseChapterHour&info=$info^'],'get_ids':['info','?q=json/ebag/mutual/getMutualBaseInfo&info=$info^'],'set_cours_chapter_hour':['dist','?q=json/ebag/Coursehourrecord/record&info=$info^']};this.get_other_id=function(para,callback){var info={'userid':para.user_id,'class_id':para.class_id,'edu_subject_id':para.edu_subject_id,'course_id':para.course_id};kw_api(me.urls['get_ids'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得bookid 和 课时id 章节id 失败')})};this.get_index_info=function(para,callback){var info={'course_hour_id':para.course_hour_id,'userid':para.user_id,'class_id':para.class_id,'course_id':para.course_id};kw_api(me.urls['get_index_info'],{'info':kw_tojson(info)},{},function(data){if(data["status"]!=1){alert(data["msg"]);return}callback&&callback.apply(null,[data["recordset"]])},function(){alert('ebag/mutual/readResource接口取数据失败！')})};this.get_book_chapter=function(para,callback){var info={'class_id':para.class_id,'edu_book_id':para.edu_book_id};kw_api(me.urls['get_book_chapter'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["data"]])},function(){alert('获取课本章节数据失败！')})};this.get_book_period=function(para,callback){var info={'userid':para.user_id,'edu_chapter_id':para.edu_chapter_id};kw_api(me.urls['get_book_period'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('取章节对应的课时数据失败')})};this.set_cours_chapter_hour=function(para){var info={'course_hour_id':para.course_hour_id,'userid':para.user_id,'class_id':para.class_id,'course_id':para.course_id};kw_api(me.urls['set_cours_chapter_hour'],{'info':kw_tojson(info)},{},function(data){},function(){})}}function CKW_reslist_d(){var me=this;this.chapter_name="第一章";this.course_name="第一课时";this.all_chapter="";this.resource_list=[];this.set_chapter_name=function(name){me.chapter_name=name||"第一章"};this.get_chapter_name=function(){return me.chapter_name};this.set_course_name=function(name){me.course_name=name||"第一课时"};this.get_course_name=function(){return me.course_name};this.set_all_chapter=function(all){me.all_chapter=all};this.get_all_chapter=function(){return me.all_chapter}}function CKW_reslist_go(){var me=this;this.start_blosmx=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];CTool.a.zoomin.zoom_out();CTool.c.bloswx.go(params)};this.start_atqti=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];CTool.a.zoomin.zoom_out();CTool.c.icom.go(params)};this.start_ivideo=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];CTool.a.zoomin.zoom_out();CTool.c.icom.go(params)};this.start_dms=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];CTool.a.zoomin.zoom_out();CTool.c.icom.go(params)};this.start_icom=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];CTool.a.zoomin.zoom_out();CTool.c.icom.go(params)};this.start_img=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];var src="http://oddl.static."+window.config.domain+"/d/"+HAr.get(params,['file_hash']);$("#useforuploadfile").length&&$("#useforuploadfile").remove();$(document.body).append("<div id='useforuploadfile' style='display: none;'><iframe src='"+src+"'></iframe></div>");CTool.a.zoomin.zoom_out()};this.start_upfile=function(resource_id){var list=HAr.rebuild(CReslist.d.resource_list,'resource_id','row');var params=list[resource_id];var url="http://oddl.static."+window.config.domain+"/d/"+HAr.get(params,['file_hash']);if($("#useforuploadfile").length>0){$("#useforuploadfile").remove()}$(document.body).append("<div id='useforuploadfile' style='display: none;'><iframe src='"+url+"'></iframe></div>");CTool.a.zoomin.zoom_out()}}function CKW_reslist(){var me=this;this.on=function(){_instance('CReslist.a');_instance('CReslist.api');_instance('CReslist.go');_instance('CReslist.d')};this.start=function(para){me.on();$('.student-total').html(DApp.class_info.student_counter);CReslist.a.ids['class_id']=DApp.class_info.class_id;CReslist.a.ids['user_id']=DApp.user_info.userid;CReslist.a.ids['edu_subject_id']=DApp.class_info.subject_id;CReslist.a.ids['course_id']=DApp.class_info.course_id;CReslist.api.get_other_id(CReslist.a.ids,function(data){for(var key in CReslist.a.ids){if(key in data)CReslist.a.ids[key]=data[key]}if(para.data.hour_id){CReslist.a.ids['course_hour_id']=para.data.hour_id}else if(DApp.hour_id){CReslist.a.ids['course_hour_id']=DApp.hour_id}DApp.hour_id=CReslist.a.ids['course_hour_id'];DApp.chapterid=CReslist.a.ids['edu_chapter_id'];CTool.sw('reslist',{},function(dom){CReslist.api.get_index_info(CReslist.a.ids,function(data){CReslist.d.resource_list=data["resource_list"];kw_tpl("reslist/reslist.tpl.html",{'list':data["resource_list"]},function(html_reslist){kw_tpl("reslist/main.tpl.html",{'class_name':DApp.class_info.class_name,'grade':DApp.class_info.grade_name,'chapter_hour_info':data["chapter_hour_info"],'html_reslist':html_reslist},function(html){dom.html(html);if(DApp.started){$(".class-index > h2 i").hide()}})})})})})}}function CKW_selclass_a(){var me=this;this.on_clk_class=function(class_id,subject_id,course_id,book_id){$.each(CSelclass.api_data.grade,function(iA,rA){$.each(rA.class_info,function(iB,rB){if(rB.class_id==class_id){DApp.class_info={'class_id':rB.class_id,'server_ip':rB.server_ip,'student_counter':rB.student_counter,'course_id':course_id,'grade_name':rA.edu_grade_name,'class_name':rB.class_name,'subject_id':subject_id,'book_id':book_id}}})});CTool.api.ebook_exist();_instance('CNotclose',function(){CNotclose.index()})}}function CKW_selclass(){var me=this;this.api_data={};this.on=function(){_instance('CSelclass.a')};this.index=function(){me.on();var grade=me.api_data.grade;DApp.user_info={'userid':me.api_data.userid,'username':me.api_data.username,'real_name':me.api_data.real_name};var lists=[];$.each(grade,function(i,row){$.each(row.class_info,function(iA,rA){$.each(rA.edu_subject,function(iB,rB){lists.push([rA.class_id,rB.edu_subject_id,rB.course_id,rB.edu_book_id])})})});if(lists.length==1){CSelclass.a.on_clk_class(lists[0][0],lists[0][1],lists[0][2],lists[0][3])}else{kw_tpl('selclass/index.tpl.html',{'data':grade},function(html){$('#full_container').html(html)})}}}function CKW_tongji_a(){var me=this;this.get_all_tj=function(para){CTool.sw('tongji',{'tongji_type':'taoti','para':para},function(dom){kw_tpl("tongji/tongji_all.tpl.html",{"allpage":para.length,"nowpage":1},function(html){dom.html(html);CTongji.chart.draw_tongji_all(para);me.get_all_single_js(para[0])})})};this.get_all_single_js=function(para){CTool.d.params={'tongji_type':'taoti','para':para};CTongji.api.tongji_single(para,function(data){if(data["alias"]=="wenda"){kw_tpl("tongji/tongji_helpers/wenda.tpl.html",{"data":data["user"],"isTaoti":1},function(html_str){$("#com_container").html(html_str);$("#com_container .tongji_title").hide();LQti.start_atqti({"container":"wenda_question_title1","id_list":[para["qti_question_id"]]})});return}kw_tpl("tongji/check_answer.tpl.html",data,function(check_html){kw_tpl("tongji/tongji_single.tpl.html",{"check_html":check_html,"isTaoti":1},function(html){$("#com_container").html(html);$("#com_container .tongji_title").hide();LQti.start_atqti({"container":"single_qti1","id_list":[para["qti_question_id"]]});data["render"]="single_canvasDiv1";CTongji.chart.draw_tongji_single(data);CTongji.event.start()})})})};this.get_single_tj=function(para){CTool.sw('tongji',{'tongji_type':'single',"para":para},function(dom){CTongji.api.tongji_single(para,function(data){if(data["alias"]=="wenda"){kw_tpl("tongji/tongji_helpers/wenda.tpl.html",{"data":data["user"],"isTaoti":''},function(html_str){dom.html(html_str);LQti.start_atqti({"container":"wenda_question_title","id_list":[para["qti_question_id"]]})});return}kw_tpl("tongji/check_answer.tpl.html",data,function(check_html){kw_tpl("tongji/tongji_single.tpl.html",{"check_html":check_html,"isTaoti":""},function(html){dom.html(html);LQti.start_atqti({"container":"single_qti","id_list":[para["qti_question_id"]]});data["render"]="single_canvasDiv";CTongji.chart.draw_tongji_single(data);CTongji.event.start()})})})})};this.get_zujian_tj=function(para){CTool.sw('tongji',{'tongji_type':'zujian'},function(dom){CTongji.api.tongji_zujian(para,function(data1){kw_tpl("tongji/tongji_zujian.tpl.html",data1,function(html){dom.html(html);CTongji.chart.draw_tongji_zujian(data1)})})})};this.get_dms_tj=function(para){CTool.sw('tongji',{'tongji_type':'dms'},function(dom){CTongji.api.tongji_dms(para,function(data1){kw_tpl("tongji/tongji_dms.tpl.html",data1,function(html){dom.html(html)})})})}}function CKW_tongji_api(){var me=this;this.urls={"complete_para":['info','?q=json/ebag/Publish/getPracticeMiniResource&info=$info^'],"all_qti_tj":['info','?q=json/ebag/mutualstat/getComplexQuestion&info=$info^'],"single_qti_tj":['info','?q=json/ebag/Statistics/QuestionStatistics/getQuestionStatistics&info=$info^'],"zujian_tj":['info','?q=json/ebag/mutualstat/getEnglishComponent&info=$info^'],"dms_tj":""};this.get_complete=function(para,callback){var info={"course_hour_publish_id":DApp.publish_id,"course_resource_id":para.course_resource_id,"dcom_entity_id":para.dcom_entity_id};kw_api(me.urls['complete_para'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得qit统计列表失败')})};this.tongji_all=function(para,callback){var info={"course_hour_publish_id":1150,"qti_test_id":1150};kw_api(me.urls['all_qti_tj'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得套题统计数据失败')})};this.tongji_single=function(para,callback){var info={"course_hour_publish_id":para.course_hour_publish_id,"course_resource_id":para.course_resource_id,"qti_question_id":para.qti_question_id,"dcom_entity_id":para.dcom_entity_id};kw_api(me.urls['single_qti_tj'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得单题统计数据失败')})};this.tongji_zujian=function(para,callback){var info={"course_hour_publish_id":para.course_hour_publish_id,"resource_id":para.resource_id};kw_api(me.urls['zujian_tj'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得组件统计数据失败')})};this.tongji_dms=function(para,callback){var info={"course_hour_publish_id":para.course_hour_publish_id,"resource_id":para.resource_id};kw_api(me.urls['dms_tj'],{'info':kw_tojson(info)},{},function(data){callback&&callback.apply(null,[data["recordset"]])},function(){alert('获得图形计算器统计数据失败')})}}function CKW_tongji_event(){var me=this;this.start=function(data){$(document.body).off("mousedown");$(document.body).off("mouseover");$(document.body).on("mousedown",function(e){if(e.target.tagName=="INPUT"&&e.target.getAttribute("class")=="qti_fill_input"){me.show_result_fillin(e.target)}});$(document.body).on("mouseover",function(e){if(e.target.tagName=="INPUT"&&e.target.getAttribute("class")=="qti_fill_input"){$(e.target).css("cursor","pointer")}})};this.show_result_fillin=function(dom){$(dom).next().next().show();if($(dom).next().next().get(0).tagName=="SELECT"){var answer=CTongji.chart.wanxingtiankong.mydata[$(dom).attr("sequence")-1].answer;$(dom).next().next().children().each(function(index){if($(this).html().indexOf(answer)>=0){this.selected="selected"}})}$(dom).hide()};this.click_tongji_info=function(){$(".qti_fill_input").each(function(){me.show_result_fillin(this)})}}function CKW_tongji(){var me=this;this.on=function(){_instance("CTongji.a");_instance("CTongji.api");_instance("CTongji.chart",function(){CTongji.chart.on()});_instance("CTongji.event")};this.start_qti=function(para){me.on();CTongji.api.get_complete(para,function(data){if(data.length==1){CTongji.a.get_single_tj({"course_hour_publish_id":DApp.publish_id,"course_resource_id":data[0].course_resource_id,"qti_question_id":data[0].qti_question_id,"dcom_entity_id":data[0].dcom_entity_id})}else if(data.length>1){CTongji.a.get_all_tj(data)}})};this.start_dms=function(para){me.on();CTongji.a.get_dms_tj({"course_hour_publish_id":DApp.publish_id,"resource_id":para["resource_id"]})};this.start_zujian=function(para){me.on();CTongji.a.get_zujian_tj({"course_hour_publish_id":DApp.publish_id,"resource_id":para["resource_id"]})}}function CKW_tongji_chart_danxuan(){var me=this;this.draw=function(para,render){var data=[];var arr=para;for(var key in arr){data.push({name:arr[key].count+'人'+(key=="noanswer"?"未答":("选"+key)),value:arr[key].count,color:CTongji.chart.color_arr[data.length],callback_para:{"render":render,"id":(data.length+1),"data":arr[key].students}})}KW_chart.draw_pie_3D(render,data,CTongji.chart.pie_show_student)}}function CKW_tongji_chart_duoxuan(){var me=this;this.draw=function(para,render){var data=[];var arr=para;for(var key in arr){data.push({name:arr[key].count+'人'+(key=="noanswer"?"未答":key=="other"?"其他":("选"+key)),value:arr[key].count,color:CTongji.chart.color_arr[data.length],callback_para:{"render":render,"id":(data.length+1),"data":arr[key].students}})}KW_chart.draw_pie_3D(render,data,CTongji.chart.pie_show_student)}}function CKW_tongji_chart(){var me=this;this.color_arr=["#4572a7",'#aa4643','#89a54e','#80699b','#92a8cd','#db843d'];this.on=function(){_instance("CTongji.chart.tiankong");_instance("CTongji.chart.paixu");_instance("CTongji.chart.wanxingtiankong");_instance("CTongji.chart.danxuan");_instance("CTongji.chart.duoxuan");_instance("CTongji.chart.panduan");_instance("CTongji.chart.taoti");_instance("CTongji.chart.zujian");_instance("CTongji.chart.wenda")};this.draw_tongji_all=function(para){CTongji.chart.taoti.draw(para)};this.draw_tongji_single=function(para){if(para.alias=="danxuan"){CTongji.chart.danxuan.draw(para.record,para["render"])}else if(para.alias=="panduan"){CTongji.chart.panduan.draw(para.record,para["render"])}else if(para.alias=="duoxuan"){CTongji.chart.duoxuan.draw(para.record,para["render"])}else if(para.alias=="tiankong"){CTongji.chart.tiankong.draw(para.record,para["render"])}else if(para.alias=="cloze"){CTongji.chart.wanxingtiankong.draw(para.record,para["render"])}else if(para.alias=="sort"){CTongji.chart.paixu.draw(para.record,para["render"])}else{CTongji.chart.tiankong.draw(para.record,para["render"])}};this.draw_tongji_zujian=function(para){CTongji.chart.zujian.draw(para)};this.pie_show_student=function(para){if($("#studentlist"+para["id"]).length>0){$("#the_students").remove();return}if($("#the_students").length>0)$("#the_students").remove();kw_tpl("tongji/tongji_helpers/pie_student_list.tpl.html",{"id":para["id"],"data":para["data"]},function(html){$("#"+para["render"]).append(html);$("#the_students").css("background",""+me.color_arr[para["id"]-1]);$("#the_students").show()})};this.student_list_location=function(id){var left=HEvent.d.pageX;var top=HEvent.d.pageY;$("#"+id).css({"left":left,"top":top});if($("#"+id).width()<300){$("#"+id).css({"left":"auto","top":top,"right":($(".tongji").eq(0).width()-HEvent.d.pageX)+"px"})}if(($("#"+id).height()+HEvent.d.pageY)>$(".tongji").eq(0).height()){$("#"+id).css({"top":"auto","bottom":($(".tongji").eq(0).height()-HEvent.d.pageY)+"px"})}$("#"+id).show()};this.change_style=function(dom){$(".table_table tr td").css("color","#000");$(dom).css("color","red")}}function CKW_tongji_chart_paixu(){var me=this;this.mydata='';this.draw=function(para,render){var data=[];var data_min=[];me.mydata=para;for(var key in para){data_min.push({"name":key=="noanswer"?"未答":key=="other"?"其他":para[key].alias,"value":para[key].count,"func":"CTongji.chart.paixu.show_student_paixu('"+key+"')","colspan":""})}data.push(data_min);KW_chart.draw_table(render,data)};this.show_student_paixu=function(key){var data=me.mydata[key].students;if(data.length<=0){return}kw_tpl(key=="other"?"tongji/tongji_helpers/paixu_student_erroranswer.tpl.html":"tongji/tongji_helpers/paixu_student_list.tpl.html",{"data":data,"key":me.mydata[key].alias||"未答"},function(html_str){$("#show_student_list").remove();$("#show_students_answer").remove();$(".tongji").eq(0).append(html_str);CTongji.chart.student_list_location("show_student_list")})}}function CKW_tongji_chart_panduan(){var me=this;this.draw=function(para,render){var data=[];var arr=para;var show_style=para["subjectId"]==3?{"T":"×","F":"√","noanswer":"noanswer"}:{"T":"对","F":"错","noanswer":"未答"};for(var key in arr){data.push({name:arr[key].count+'人'+(key=="noanswer"?"未答":('选'+show_style[key])),value:arr[key].count,color:CTongji.chart.color_arr[data.length],callback_para:{"render":render,"id":(data.length+1),"data":arr[key].students}})}KW_chart.draw_pie_3D(render,data,CTongji.chart.pie_show_student)}}function CKW_tongji_chart_taoti(){var me=this;this.chart="";this.mydata='';this.nowpage='';this.allpage='';this.draw=function(para){me.nowpage=1;me.allpage=para.length;var data=[];me.mydata=para;for(var i=0;i<para.length;i++){data[i]={name:(i+1)+"题",value:para[i].type=="subjective"?20:para[i].average_rates,othervalue:(para[i].type=="subjective"?para[i].name:""),color:para[i].type=="subjective"?'#fff':'#a5c2d5',callback_para:{"para":para[i],"nowpage":(i+1),"allpage":para.length}}}me.chart=KW_chart.draw_column_2D("all_canvasDiv",data,me.show_all_single,parseInt($(".tongji_container").width()*0.9),parseInt($(".tongji_container").height()*0.9));try{window.removeEventListener("resize",me.resize_taoti_chart)}catch(e){}window.addEventListener("resize",me.resize_taoti_chart)};this.resize_taoti_chart=function(){console.log(1);me.chart.push("column_width",50);var w=$("#all_div").parent().width()*0.9;var h=$("#all_div").parent().height()*0.9;me.chart.resize(parseInt(w),parseInt(h))};this.show_all_single=function(para){me.nowpage=para["nowpage"];me.allpage=para["allpage"];CTongji.a.get_all_single_js(para["para"]);$("#tongji_page").html(para["nowpage"]+"/"+para["allpage"]);$('#all_chart_container').hide()};this.previous=function(){if(me.nowpage<=0){me.nowpage=0;return}me.nowpage=me.nowpage-1;me.show_all_single({"para":me.mydata[me.nowpage-1],"nowpage":me.nowpage,"allpage":me.allpage})};this.next=function(){if(me.nowpage>=me.allpage){me.nowpage=me.allpage;return}me.nowpage=me.nowpage+1;me.show_all_single({"para":me.mydata[me.nowpage-1],"nowpage":me.nowpage,"allpage":me.allpage})}}function CKW_tongji_chart_tiankong(){var me=this;this.mydata='';this.draw=function(para,render){var data=[];me.mydata=para;for(var i=0;i<para.length;i++){var data_min=[];for(var key in para[i].record){data_min.push({"name":key=="right"?"答对":key=="wrong"?"答错":"未答","value":para[i].record[key].count,"func":"CTongji.chart.tiankong.show_student_tiankong("+i+",'"+key+"')","colspan":""})}data.push(data_min)}KW_chart.draw_table(render,data)};this.show_student_tiankong=function(i,key){var data=me.mydata[i].record[key].students;if(data.length<=0){return}kw_tpl("tongji/tongji_helpers/tiankong_student_list.tpl.html",{"data":data,"key":key,"id":i},function(html_str){$("#show_student_list").remove();$("#show_students_answer").remove();$(".tongji").eq(0).append(html_str);CTongji.chart.student_list_location("show_student_list")})};this.show_student_answer=function(id,i){var answer=me.mydata[id].record["wrong"].students[i].answer;var name=me.mydata[id].record["wrong"].students[i].real_name;kw_tpl("tongji/tongji_helpers/tiankong_student_erroranswer.tpl.html",{"answer":answer,"name":name},function(html_str){$("#show_students_answer").remove();$(".tongji").eq(0).append(html_str);$("#show_students_answer").addClass("tiankong_error");CTongji.chart.student_list_location("show_students_answer")})}}function CKW_tongji_chart_wanxingtiankong(){var me=this;this.mydata='';this.draw=function(para,render){var data=[];me.mydata=para;for(var i=0;i<para.length;i++){var data_min=[];for(var key in para[i].record){data_min.push({"name":key,"value":para[i].record[key].count,"func":"CTongji.chart.wanxingtiankong.show_student_wangxingtiankong("+i+",'"+key+"')","answer":para[i].answer})}data.push(data_min)}KW_chart.draw_table(render,data)};this.show_student_wangxingtiankong=function(i,key,e){var data=me.mydata[i].record[key].students;if(data.length<=0){return}kw_tpl("tongji/tongji_helpers/wanxingtiankong_student_list.tpl.html",{"data":data,"question_num":(i+1),"answer":key},function(html_str){$("#show_student_list").remove();$("#show_students_answer").remove();$(".tongji").eq(0).append(html_str);CTongji.chart.student_list_location("show_student_list")})}}function CKW_tongji_chart_wenda(){var me=this;this.draw=function(para){};this.click_student=function(dom,name,istaoti){$("#wenda_student_list"+istaoti+" li").css("background","#fff");$(dom).css("background","#fff4c9");if($("#wenda_detail"+istaoti+" li:contains('"+name+"')").eq(0).length<=0){return}var html="<li style='clear: both;'>"+$("#wenda_detail"+istaoti+" li:contains('"+name+"')").eq(0).html()+"</li>";$("#wenda_detail"+istaoti+" li:contains('"+name+"')").eq(0).remove();$("#wenda_detail"+istaoti+" li").eq(0).css("background","#fff");$("#wenda_detail"+istaoti+"").prepend(html);$(".tongji_container").get(0).scrollTop=0;$("#wenda_detail"+istaoti+" li").eq(0).css("background","#fff4c9")}}function CKW_tongji_chart_zujian(){var me=this;this.chart="";this.draw=function(para){var data=[{"name":"0-59%","value":"50",color:'#a5c2d5',"unit":"人",callback_para:{"render":"zujian_canvasDiv","id":1,"data":[{"userid":197,"real_name":"哈哈"},{"userid":198,"real_name":"李佳"}]}},{"name":"60-69%","value":"1",color:'#a5c2d5',callback_para:{"render":"zujian_canvasDiv","id":2,"data":[{"userid":197,"real_name":"哈哈1"},{"userid":198,"real_name":"李佳1"}]}},{"name":"70-89%","value":"2",color:'#a5c2d5',callback_para:{"render":"zujian_canvasDiv","id":3,"data":[{"userid":197,"real_name":"哈哈2"},{"userid":198,"real_name":"李佳2"}]}},{"name":"90-99%","value":"3",color:'#a5c2d5',callback_para:{"render":"zujian_canvasDiv","id":4,"data":[{"userid":197,"real_name":"哈哈3"},{"userid":198,"real_name":"李佳3"}]}},{"name":"100%","value":"10",color:'#a5c2d5',callback_para:{"render":"zujian_canvasDiv","id":5,"data":[{"userid":197,"real_name":"哈哈4"},{"userid":198,"real_name":"李佳4"}]}}];me.chart=KW_chart.draw_column_2D("zujian_canvasDiv",data,me.show_zujian_students,$(".tongji_container").width(),$(".tongji_container").height());try{window.removeEventListener("resize",me.resize_zujian_chart)}catch(e){}window.addEventListener("resize",me.resize_zujian_chart)};this.resize_zujian_chart=function(){me.chart.push("column_width",50);var w=$("#zujian_canvasDiv").parent().width();var h=$("#zujian_canvasDiv").parent().height();me.chart.resize(w,h)};this.show_zujian_students=function(para){if($("#zujian_studentlist"+para["id"]).length>0){$("#zujian_students").remove();return}if($("#zujian_students").length>0)$("#zujian_students").remove();kw_tpl("tongji/tongji_helpers/zujian_student_list.tpl.html",{"id":para["id"],"data":para["data"]},function(html){$(".tongji").append(html);CTongji.chart.student_list_location("zujian_students")})}}function CKW_tool_a_bloswx(){var me=this;this.iframe=null;this.page=null;this.start=function(){CTool.sw('bloswx',{'id':1234},function(dom){dom.find('iframe')[0].src="bloswx.html"})};this.gotoPage=function(page){var frame=$('#'+CTool.d.dom_id+' iframe')[0];var msg=kw_tojson({type:'Blos.gotoPage','data':page});frame.contentWindow.postMessage(msg,'*');$('.dialog-base').empty().removeClass('dialog-mask-white dialog-mask-black')}};function CKW_tool_a_brush_bg(){var me=this;var parent=CTool.a.brush;this.open=function(){if(!$('#bg_brush').length){$('#main_container').append('<div id="bg_brush"><canvas width="'+($("#main_container").width())+'" height="'+($("#main_container").height())+'" onmousedown="CTool.a.brush.bg.down.apply(this,[event]);" onmousemove="CTool.a.brush.bg.move(event);" onmouseup="CTool.a.brush.bg.up.apply(this,[event]);" style="position:absolute;"></canvas></div>')}$('#bg_brush').show();me.init_cxt()};this.close=function(){$('#bg_brush').hide()};this.init_cxt=function(){me.canvas=$('#bg_brush canvas')[0];me.cxt=me.canvas.getContext('2d');me.cxt.lineWidth=parent.brush_width[parent.brush_type];me.cxt.strokeStyle=parent.colors[parent.color_type];if(parent.brush_type==2){me.cxt.globalAlpha=.3}else{me.cxt.globalAlpha=1}if(parent._is_eraser){me.cxt.globalAlpha=1}me.cxt.lineJoin="round"};this.down=function(event){me.init_cxt();me.point_d={'x':event.pageX,'y':event.pageY};if(parent._is_eraser){me.cxt.globalCompositeOperation="destination-out";me.cxt.beginPath();me.cxt.arc(event.pageX,event.pageY,parent.eraser_width[parent.eraser_type],0,Math.PI*2);me.cxt.strokeStyle="rgba(250,250,250,0)";me.cxt.fill();me.cxt.globalCompositeOperation="source-over";return}this.setCapture&&this.setCapture()};this.move=function(event){if(!me.point_d)return;if(parent._is_eraser){me.cxt.globalCompositeOperation="destination-out";me.cxt.beginPath();me.cxt.arc(event.pageX,event.pageY,parent.eraser_width[parent.eraser_type],0,Math.PI*2);me.cxt.strokeStyle="rgba(250,250,250,0)";me.cxt.fill();me.cxt.globalCompositeOperation="source-over";return}var main_container_scrollLeft=$('#main_container').scrollLeft();var main_container_scrollTop=$('#main_container').scrollTop();function compute(p){if(CTool.a.zoomin.is_zoom_in){return[(p[0]+main_container_scrollLeft)/2,(p[1]+main_container_scrollTop)/2]}else{return[p[0]+main_container_scrollLeft,p[1]+main_container_scrollTop]}}var p1=compute([me.point_d.x,me.point_d.y]);var p2=compute([event.pageX,event.pageY]);me.cxt.beginPath();me.cxt.moveTo(p1[0],p1[1]);me.cxt.lineTo(p2[0],p2[1]);me.cxt.closePath();me.cxt.stroke();me.point_d.x=event.pageX;me.point_d.y=event.pageY};this.up=function(event){this.releaseCapture&&this.releaseCapture();me.point_d=null};this.clear=function(){me.cxt.clearRect(0,0,me.canvas.width,me.canvas.height);me._is_eraser=false}};function CKW_tool_a_brush_gli(){var me=this;var parent=CTool.a.brush;this.points=[];this.open=function(){if(!$('#brush_gli').length){$('#main_brush').append('<div class="brushes" id="brush_gli" style="z-index:2;"><canvas width="'+($("#main_container").get(0).scrollWidth)+'" height="'+($("#main_container").get(0).scrollHeight)+'" onmousedown="CTool.a.brush.gli.down.apply(this,[event]);" onmousemove="CTool.a.brush.gli.move(event);" onmouseup="CTool.a.brush.gli.up.apply(this,[event]);" style="position:absolute;"></canvas></div>')}$('#brush_gli').show();this.init_cxt()};this.close=function(){$('#brush_gli').hide()};this.init_cxt=function(){me.canvas=$('#brush_gli canvas')[0];me.cxt=me.canvas.getContext('2d');me.cxt.lineWidth=18;me.cxt.strokeStyle=parent.colors[parent.color_type];me.cxt.globalAlpha=.3};this.compute=function(p){var main_container_scrollLeft=$('#main_container').scrollLeft();var main_container_scrollTop=$('#main_container').scrollTop();var main_data_top=parseInt($('#main_container #main_datas').css('top'));if(CTool.a.zoomin.is_zoom_in){return[(p[0]+main_container_scrollLeft)/2,(p[1]+main_container_scrollTop-main_data_top)/2]}else{return[p[0]+main_container_scrollLeft,p[1]+main_container_scrollTop-main_data_top]}};this.down=function(event){me.point_d={'x':event.pageX,'y':event.pageY};me.cxt.lineJoin="round";this.setCapture&&this.setCapture();me.points.push([event.pageX,event.pageY])};this.move=function(event){if(!me.point_d)return;var p1=me.compute([me.point_d.x,me.point_d.y]);var p2=me.compute([event.pageX,event.pageY]);me.cxt.beginPath();me.cxt.moveTo(p1[0],p1[1]);me.cxt.lineTo(p2[0],p2[1]);me.cxt.closePath();me.cxt.stroke();me.point_d.x=event.pageX;me.point_d.y=event.pageY;me.points.push([event.pageX,event.pageY])};this.up=function(event){this.releaseCapture&&this.releaseCapture();me.point_d=null;me.clear();parent.draw_points(me.points);me.points=[]};this.clear=function(){me.cxt.clearRect(0,0,me.canvas.width,me.canvas.height)}};function CKW_tool_a_brush(){var me=this;this.canvas=null;this.point_d=null;this.cxt=null;this.colors=['#1366FD','#FFEA00','#06B10A','#9F09C4','#F30000','#000000'];this.color_type=5;this.brush_width=[2,10,18];this.brush_type=0;this._is_eraser=false;this.eraser_width=[30,80,160];this.eraser_type=0;this.now_cdom_id=function(){if(typeof HAr.get(CTool.c,[CTool.d.type,'cdom_id'])=='function'){var cdom_id=HAr.get(CTool.c,[CTool.d.type,'cdom_id'])(CTool.d.get_params());return cdom_id}else{return'brush_'}};this.start=function(){CTool.a.close_many(['brush','curtain','enlarge']);if(!$('#brush_tool').length){$(document.body).append('<div id="brush_tool" class="class-brush abs"></div>');kw_tpl('tool/brush.tpl.html',{},function(html){$('#brush_tool').html(html)})}var brush_id=me.now_cdom_id();if($('#brush_tool').css('display')=='none'){$('#main_brush').show();$('#main_brush >div').hide();if(!$('#'+brush_id).length){$('#main_brush').append('<div class="brushes" id="'+brush_id+'"><canvas width="'+($("#main_container").get(0).scrollWidth)+'" height="'+($("#main_container").get(0).scrollHeight)+'" onmousedown="CTool.a.brush.down.apply(this,[event]);" onmousemove="CTool.a.brush.move(event);" onmouseup="CTool.a.brush.up.apply(this,[event]);" style="position:absolute;"></canvas></div>')}$('#'+brush_id).show();$('#brush_tool').show();$('.bar-icon.icon-brush').addClass('btn-on');me.init_cxt();me.bg.open()}else{$('#brush_tool').hide();$('#main_brush').hide();me.bg.close();$('.bar-icon.icon-brush').removeClass('btn-on')}};this.init_cxt=function(){var brush_id=me.now_cdom_id();me.canvas=$('#'+brush_id+' canvas')[0];me.cxt=me.canvas.getContext('2d');me.cxt.lineWidth=me.brush_width[me.brush_type];me.cxt.strokeStyle=me.colors[me.color_type];if(me.brush_type==2){me.cxt.globalAlpha=.3;me.gli.open()}else{me.cxt.globalAlpha=1}me.cxt.lineJoin="round"};this.compute=function(p){var main_container_scrollLeft=$('#main_container').scrollLeft();var main_container_scrollTop=$('#main_container').scrollTop();var main_data_top=parseInt($('#main_container #main_datas').css('top'));if(CTool.a.zoomin.is_zoom_in){return[(p[0]+main_container_scrollLeft)/2,(p[1]+main_container_scrollTop-main_data_top)/2]}else{return[p[0]+main_container_scrollLeft,p[1]+main_container_scrollTop-main_data_top]}};this.down=function(event){me.point_d={'x':event.pageX,'y':event.pageY};if(me._is_eraser){var p=me.compute([event.pageX,event.pageY]);me.cxt.globalCompositeOperation="destination-out";me.cxt.beginPath();me.cxt.arc(p[0],p[1],me.eraser_width[me.eraser_type],0,Math.PI*2);var bak=me.cxt.strokeStyle;me.cxt.strokeStyle="rgba(250,250,250,0)";me.cxt.fill();me.cxt.globalCompositeOperation="source-over";me.cxt.strokeStyle=bak;return}this.setCapture&&this.setCapture()};this.move=function(event){if(!me.point_d)return;if(me._is_eraser){var p=me.compute([event.pageX,event.pageY]);me.cxt.globalCompositeOperation="destination-out";me.cxt.beginPath();me.cxt.arc(p[0],p[1],me.eraser_width[me.eraser_type],0,Math.PI*2);var bak=me.cxt.strokeStyle;me.cxt.strokeStyle="rgba(250,250,250,0)";me.cxt.fill();me.cxt.globalCompositeOperation="source-over";me.cxt.strokeStyle=bak;return}var p1=me.compute([me.point_d.x,me.point_d.y]);var p2=me.compute([event.pageX,event.pageY]);me.cxt.beginPath();me.cxt.moveTo(p1[0],p1[1]);me.cxt.lineTo(p2[0],p2[1]);me.cxt.closePath();me.cxt.stroke();me.point_d.x=event.pageX;me.point_d.y=event.pageY};this.draw_points=function(points){me.cxt.beginPath();me.cxt.moveTo(points[0].x,points[0].y);var p=[];for(var i=1;i<points.length;i++){p=me.compute(points[i]);me.cxt.lineTo(p[0],p[1])}me.cxt.stroke()};this.up=function(event){this.releaseCapture&&this.releaseCapture();me.point_d=null};this.on_width=function(type){me.brush_type=type;me.cxt.lineWidth=me.brush_width[me.brush_type];me.cxt.globalAlpha=1;$(this).siblings().removeClass('btn-on');$(this).addClass('btn-on');me._is_eraser=false;$('.btn-brush.icon-eraser').removeClass('btn-on');me.gli.close();$('.color-brush-group').show();$('.block-eraser-group').hide()};this.on_glitter=function(){me.brush_type=2;me.cxt.lineWidth=me.brush_width[me.brush_type];me.cxt.globalAlpha=.3;$(this).siblings().removeClass('btn-on');$(this).addClass('btn-on');me._is_eraser=false;$('.btn-brush.icon-eraser').removeClass('btn-on');me.gli.open();$('.color-brush-group').show();$('.block-eraser-group').hide()};this.on_eraser=function(){me._is_eraser=true;$('.btn-brush.icon-eraser').siblings().removeClass('btn-on');$('.btn-brush.icon-eraser').addClass('btn-on');me.gli.close();$('.color-brush-group').hide();$('.block-eraser-group').show();me.cxt.globalAlpha=1};this.set_color_type=function(color_type){me.color_type=color_type;me.cxt.strokeStyle=me.colors[color_type];$(this).siblings().removeClass('btn-on');$(this).addClass('btn-on');me._is_eraser=false;$('.btn-brush.icon-eraser').removeClass('btn-on');(me.brush_type==2)&&me.gli.init_cxt()};this.set_eraser_type=function(type){me.eraser_type=type;$(this).siblings().removeClass('btn-on');$(this).addClass('btn-on')};this.on_clear=function(){me.cxt.clearRect(0,0,me.canvas.width,me.canvas.height);me.bg.clear()}};function CKW_tool_a_curtain(){var me=this;this.direct=0;this.start_pos=0;this.clk=function(){CTool.a.close_many(['curtain','brush']);if(!$('#main_curtain').length){$(document.body).prepend("<div id='main_curtain'></div>");kw_tpl('tool/curtain.tpl.html',{},function(html){$('#main_curtain').html(html)})}if($('#main_curtain').css('display')=='none'){$('#main_curtain').show();$('.bar-icon.icon-screen').addClass('btn-on')}else{$('#main_curtain').hide();$('.bar-icon.icon-screen').removeClass('btn-on')}};this.top_clk=function(){this.setCapture&&this.setCapture();me.direct=1;me.start_pos=parseInt($('#main_curtain').css('top'));HEvent.fns_mv.curtain=CTool.a.curtain.move;HEvent.fns_up.curtain=CTool.a.curtain._tup};this.right_clk=function(){this.setCapture&&this.setCapture();me.direct=2;me.start_pos=parseInt($('#main_curtain').css('right'));HEvent.fns_mv.curtain=CTool.a.curtain.move;HEvent.fns_up.curtain=CTool.a.curtain._tup};this.bottom_clk=function(){this.setCapture&&this.setCapture();me.direct=3;me.start_pos=parseInt($('#main_curtain').css('bottom'));HEvent.fns_mv.curtain=CTool.a.curtain.move;HEvent.fns_up.curtain=CTool.a.curtain._tup};this.left_clk=function(){this.setCapture&&this.setCapture();me.direct=4;me.start_pos=parseInt($('#main_curtain').css('left'));HEvent.fns_mv.curtain=CTool.a.curtain.move;HEvent.fns_up.curtain=CTool.a.curtain._tup};this.move=function(){if(!HEvent.p)return;var pos,min;switch(me.direct){case 1:pos=(me.start_pos+HEvent.m.pageY-HEvent.d.pageY);min=(DApp.toolbar_pos=='top')?60:0;$('#main_curtain').css({'top':(pos<min?min:pos)+'px'});break;case 2:pos=(me.start_pos+HEvent.d.pageX-HEvent.m.pageX);min=(DApp.toolbar_pos=='right')?60:0;$('#main_curtain').css({'right':(pos<min?min:pos)+'px'});break;case 3:pos=(me.start_pos+HEvent.d.pageY-HEvent.m.pageY);min=(DApp.toolbar_pos=='bottom')?60:0;$('#main_curtain').css({'bottom':(pos<min?min:pos)+'px'});break;case 4:pos=(me.start_pos+HEvent.m.pageX-HEvent.d.pageX);min=(DApp.toolbar_pos=='left')?60:0;$('#main_curtain').css({'left':(pos<min?min:pos)+'px'});break}};this._tup=function(){me.direct=0;delete HEvent.fns_mv.curtain;delete HEvent.fns_up.curtain}};function CKW_tool_a_ebook(){var me=this;this.page=null;this.start=function(){var param={'bookid':DApp.class_info.book_id,'chapterid':DApp.chapterid};CTool.c.ebook.go(param)};this.prev=function(){seajs.use(['modules/ebook'],function(ebook){ebook.prev()})};this.next=function(){seajs.use(['modules/ebook'],function(ebook){ebook.next()})}};function CKW_tool_a_pulldown(){var me=this;this.start_pos=0;this.clk=function(){CTool.a.close_many(['pulldown','brush']);if(!$('#main_pulldown').length){$(document.body).prepend("<div id='main_pulldown' _tmv='CTool.a.pulldown.move()' _tp='CTool.a.pulldown.tp.apply(this);' _tup='CTool.a.pulldown.tup.apply(this);'><div class='reset' _tk='CTool.a.pulldown.reset();'></div></div>")}if($('#main_pulldown').css('display')=='none'){$('#main_pulldown').show();$('.bar-icon.icon-pushscreen').addClass('btn-on')}else{$('#main_pulldown').hide();$('.bar-icon.icon-pushscreen').removeClass('btn-on')}};this.tp=function(){this.setCapture&&this.setCapture();me.start_pos=parseInt($('#main_container #main_datas').css('top'))};this.move=function(){var pos=(me.start_pos+HEvent.m.pageY-HEvent.d.pageY);$('#main_container #main_datas').css({'top':(pos<0?0:pos)+'px'});$('#main_container #main_brush').css({'top':(pos<0?0:pos)+'px'})};this.tup=function(){this.releaseCapture&&this.releaseCapture()};this.reset=function(){$('#main_container #main_datas').css({'top':0});$('#main_container #main_brush').css({'top':0})}};function CKW_tool_a_zoomin(){var me=this;this.is_zoom_in=0;this.scale=2;this.scroll_left=0;this.scroll_top=0;this.zoom_toggle=function(){console.log(me.is_zoom_in);if(!me.is_zoom_in){me.zoom_in()}else{me.zoom_out()}};this.destroy=function(){if($('#zoom_in').length)$('#zoom_in').remove()};this.zoom_out=function(){me.is_zoom_in=0;me.destroy();$(".zoom_in").each(function(index){$(this).css({"transform":"translate(0,0) scale(1)"});$("#main_container").get(0).scrollLeft=me.scroll_left;$("#main_container").get(0).scrollTop=me.scroll_top});$('.bar-icon.icon-reduce').addClass('icon-enlarge').removeClass('icon-reduce').siblings('span').text('放大')};this.zoom_in=function(){if(!$('#zoom_in').length){var w=$('#main_container').get(0).scrollWidth;var h=$('#main_container').get(0).scrollHeight;$("#main_container").prepend("<div id='zoom_in' style='z-index: 25;width:"+w+"px;height: "+h+"px;position: absolute;'"+" onmousemove='CTool.a.zoomin.mousemove(event)'"+" onclick='CTool.a.zoomin.click_to_zoom_in(event)' "+" ></div> ")}};this.mousemove=function(event){if($("#zoom_in").length&&!$('#mglass').length){$("#zoom_in").prepend("<div id='mglass' class='mglass' style='position:absolute;width: 100px;height: 100px; border-radius:10px;border: 2px solid #000;'></div>")}$("#mglass").css({"left":(event.pageX+$("#main_container").get(0).scrollLeft-50)+"px","top":(event.pageY+$("#main_container").get(0).scrollTop-50)+"px"})};this.click_to_zoom_in=function(event){me.is_zoom_in=1;me.scroll_left=$("#main_container").get(0).scrollLeft;me.scroll_top=$("#main_container").get(0).scrollTop;var scoll_x=event.pageX+me.scroll_left;var scroll_y=event.pageY+me.scroll_top;var x=me.scale*scoll_x-$("#main_container").get(0).clientWidth/2;var y=me.scale*scroll_y-$("#main_container").get(0).clientHeight/2;var last_width=me.scale*$("#zoom_in").width()-$("#main_container").get(0).clientWidth/2;var last_height=me.scale*$("#zoom_in").height()-$("#main_container").get(0).clientHeight/2;x=x<0?0:x;x=x>last_width?last_width:x;y=y<0?0:y;y=y>last_height?last_height:y;$(".zoom_in").each(function(index){$(this).css({"transform":"translate(50%,50%) scale(2)"});$("#main_container").get(0).scrollLeft=x;$("#main_container").get(0).scrollTop=y});me.destroy();$('.bar-icon.icon-enlarge').addClass('icon-reduce').removeClass('icon-enlarge').siblings('span').text('缩小')}};function CKW_tool_c_bloswx(){var me=this;this.go=function(params,cancel_back){params.page=parseInt(params.page||1);params=CTool.d.DOM_STORE[me.dom_id(params)]||params;CTool.sw('bloswx',{'cid':params.cid},function(dom,is_new){var url='http://www.'+window.config.domain+'/cw-writer/courseware.php?show-mode=content';url+='&cid='+params.cid;url+='&run-env=iclass';url+='&no_privacy=yes';url+='&source=draft';url+='&mark='+dom.attr('id');url+='#{"page":"'+(params.page||1)+'"}';$('#'+CTool.d.dom_id+' iframe')[0].src=url;CTool.d.DOM_STORE[me.dom_id(params)]=params;me.set_recover(me.dom_id(params))},cancel_back)};this.set_recover=function(dom_id){CTool.api.set_recover({'STACK_BACKS':CTool.d.STACK_BACKS,'params':CTool.d.DOM_STORE[dom_id],'type':'bloswx'})};this.dom_id=function(params){var d={'cid':parseInt(params.cid)};return dom_id='bloswx_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d={'page':parseInt(params.page||1)};return dom_id='brush_bloswx_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'"><iframe width="100%" height="100%" frameborder="0" marginwidth="0" marginheight="0" style="position:absolute;"></iframe><div class="pagination"></div></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();var dom=$('#'+dom_id).show();if(DApp.started){CTool.btns=[{},{}];CTool.btns[0]['toolbox']='工具箱';CTool.btns[0]['brush']='画笔';CTool.btns[0]['student']='学生';DApp.ebook_exist&&(CTool.btns[0]['ebook']='电子课本');CTool.btns[1]['catalogue']='目录';CTool.btns[1]['prev']='上页';CTool.btns[1]['next']='下页';CTool.btns[1]['send']='发送';CTool.btns[1]['back']='返回'}else{CTool.btns=[{},{'catalogue':'目录','prev':'上页','next':'下页','start':'开始上课','back':'返回'}]}CTool.show_btns();if(!CTool.d.DOM_STORE[dom_id]){CTool.d.DOM_STORE[dom_id]={};CTool.d.DOM_STORE[dom_id].page=1}(!cancel_back)&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom,dom_isnew)};this.message=function(d){switch(d.type){case'Blos.ready':(!CTool.d.DOM_STORE[d.data.mark])&&(CTool.d.DOM_STORE[d.data.mark]={});CTool.d.DOM_STORE[d.data.mark].total=parseInt(d.data.totalPageNum);CTool.c.bloswx.set_recover(d.data.mark);$('#'+d.data.mark+' .pagination').html(HAr.get(CTool.d.DOM_STORE,[d.data.mark,'page'])+'/'+HAr.get(CTool.d.DOM_STORE,[d.data.mark,'total']));break;case'Blos.curPageNum':(!CTool.d.DOM_STORE[d.data.mark])&&(CTool.d.DOM_STORE[d.data.mark]={});CTool.d.DOM_STORE[d.data.mark].page=parseInt(d.data.number);CTool.c.bloswx.set_recover(d.data.mark);$('#'+d.data.mark+' .pagination').html(HAr.get(CTool.d.DOM_STORE,[d.data.mark,'page'])+'/'+HAr.get(CTool.d.DOM_STORE,[d.data.mark,'total']));break;case'Blos.pageSynopsis':(!CTool.d.DOM_STORE[d.data.mark])&&(CTool.d.DOM_STORE[d.data.mark]={});if(d.data.icom&&d.data.icom.length){CTool.d.DOM_STORE[d.data.mark].qti_param={'icom_id':d.data.icom[0].icomId,'dcom_id':d.data.icom[0].dcomId,'entity_id':d.data.icom[0].id}}else{CTool.d.DOM_STORE[d.data.mark].qti_param=''}CTool.c.bloswx.set_recover(d.data.mark);break}}};function CKW_tool_c_classstat(){var me=this;this.go=function(params,cancel_back){kw_go({'c':"CClassstat",'a':"start","para":{"course_hour_id":1150}})};this.dom_id=function(params){var d={};return dom_id='classstat_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d={};return dom_id='brush_classstat_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();$('#full_container').hide();var dom=$('#'+dom_id).show();CTool.btns=[{'toolbox':'工具箱','brush':'画笔'},{'back':'返回'}];CTool.show_btns();(!cancel_back&&CTool.d.type=='reslist')&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom)}};function CKW_tool_c_ebook(){var me=this;this.go=function(params,cancel_back){if(me.is_dom_new(params)){}seajs.use(['modules/ebook'],function(ebook){ebook.load(params,function(succ){CTool.sw('ebook',params,succ)})})};this.dom_id=function(params){var d={};return dom_id='ebook_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d={'page':parseInt(params.page||1)};return dom_id='brush_ebook_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.is_dom_new=function(params){var dom_id=me.dom_id(params);if(!$('#'+dom_id).length){return true}else{return false}};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'" data-bookid="'+params.bookid+'" data-chapterid="'+params.chapterid+'"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();var dom=$('#'+dom_id).show();CTool.btns=[{'toolbox':'工具箱','brush':'画笔','student':'学生'},{'catalogue':'目录','prev':'上页','next':'下页','back':'返回'}];CTool.show_btns();if(!CTool.d.DOM_STORE[dom_id]){CTool.d.DOM_STORE[dom_id]={}}(!cancel_back)&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom,dom_isnew)}};function CKW_tool_c_effectreading(){var me=this;this.go=function(params,cancel_back){};this.dom_id=function(params){var d={};return dom_id='effectreading_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d=params;return dom_id='brush_effectreading_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(params["model"]==0){if(!$('#main_datas >#'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();$('#full_container').hide();var dom=$('#'+dom_id).show();CTool.btns=[{'toolbox':'工具箱','brush':'画笔'},{'student':'学生','back':'返回'}];CTool.show_btns()}else if(params["model"]==1){if(!$('#main_datas >#'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'" style="postion:fixed;top:10px;left:10px;button:10px;right:10px;"></div>')}$('#main_datas').show();var dom=$('#'+dom_id).show()}(!cancel_back&&CTool.d.type!='qtireceive')&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom)}};function CKW_tool_c_icom(){var me=this;this.go=function(params,cancel_back){params=CTool.d.DOM_STORE[me.dom_id(params)]||params;var _params={'icom_id':params.icom_id,'dcom_id':params.dcom_id,'entity_id':'','model':'class','resource_id':params.resource_id,'course_resource_id':params.course_resource_id,'extra':params.extra||{'step':1}};seajs.use('modules/icom',function(icom){icom.load(_params,function(succ,isOver){params.isOver=isOver;CTool.sw('icom',params,succ,cancel_back);_params.resource_type=params.resource_type;CTool.d.DOM_STORE[me.dom_id(_params)]=_params;CTool.api.set_recover({'STACK_BACKS':CTool.d.STACK_BACKS,'type':'icom','params':_params})})})};this.set_extra=function(param){var extra={'step':HAr.get(param,['step'],1)};CTool.d.set_params('extra',extra)};this.dom_id=function(params){var d={'icom_id':params.icom_id||'','dcom_id':params.dcom_id||'','entity_id':'','model':'class','resource_id':params.resource_id||'','course_resource_id':params.course_resource_id||''};return dom_id='icom_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d={'extra':params.extra||{'step':1}};return dom_id='brush_icom_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'" style="background:#FFFFFF;"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();var dom=$('#'+dom_id).show();if(DApp.started&&params.isOver){CTool.btns=[{'toolbox':'工具箱','brush':'画笔'},{'viewstat':'查看统计','back':'返回'}]}else if(DApp.started){CTool.btns=[{'toolbox':'工具箱','brush':'画笔'},{'send':'发送','back':'返回'}]}else{CTool.btns=[{},{'start':'开始上课','back':'返回'}]}CTool.show_btns();(!cancel_back)&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom,dom_isnew)}};function CKW_tool_c_qtireceive(){var me=this;this.go=function(params,cancel_back){seajs.use('modules/task',function(task){task.send(params,function(succ,reCoverCommand){CTool.sw('qtireceive',params,succ,cancel_back);params.command=reCoverCommand;me.set_recover(me.dom_id(params),params);delete params.command;CTool.d.DOM_STORE[me.dom_id(params)]=params})})};this.dom_id=function(params){var d={'icom_id':params.icom_id||'','dcom_id':params.dcom_id||'','entity_id':'','model':'class','resource_id':params.resource_id||'','course_resource_id':params.course_resource_id||''};return dom_id='qtireceive_'+kw_md5(kw_tojson(d))};this.set_recover=function(dom_id,params){CTool.api.set_recover({'STACK_BACKS':CTool.d.STACK_BACKS,'params':params,'type':'qtireceive'})};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();var dom=$('#'+dom_id).show();CTool.btns=[{},{'endtest':'结束练习','resend':'重发'}];CTool.show_btns();(!cancel_back)&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom)}};function CKW_tool_c_reslist(){var me=this;this.go=function(param,cancel_back){CTool.api.ebook_exist();CTool.sw('reslist',{'hour_id':HAr.get(param,['hour_id'],0)},function(dom){kw_go({'c':"CReslist",'a':"start",'data':{'hour_id':HAr.get(param,['hour_id'],0)}});seajs.use('modules/student',function(student){student.getOnline()});CTool.api.set_recover({})},cancel_back)};this.dom_id=function(params){var d={'hour_id':parseInt(params.hour_id)};return dom_id='reslist_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d={};return dom_id='brush_reslist_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div  id="'+dom_id+'"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();$('#full_container').hide();var dom=$('#'+dom_id).show();if(DApp.started){CTool.btns=[{},{}];CTool.btns[0]['toolbox']='工具箱';CTool.btns[0]['brush']='画笔';CTool.btns[0]['student']='学生';DApp.ebook_exist&&(CTool.btns[0]['ebook']='电子课本');CTool.btns[1]['classstat']='课堂统计';CTool.btns[1]['platform']='备课平台';CTool.btns[1]['end']='结束上课'}else{CTool.btns=[{},{'student':'学生','start':'开始上课'}]}CTool.show_btns();typeof succ=='function'&&succ(dom)}};function CKW_tool_c_selclass(){var me=this;this.go=function(param,cancel_back){CTool.sw('selclass',{},function(){CSelclass.index()})};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;if(!$('#full_container').length){dom_isnew=true;$(document.body).append('<div id="full_container"></div>')}$('#main_datas').hide();$('#main_datas > div').hide();$('#main_tools').hide();var dom=$('#full_container').show();typeof succ=='function'&&succ(dom)}};function CKW_tool_c_students(){var me=this;this.show=function(type,params,succ,cancel_back){var dom_isnew=false;if(!$('#main_datas > .students').length){dom_isnew=true;$('#main_datas').append('<div class="students"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();$('#full_container').hide();var dom=$('#main_datas > .students').show();if(DApp.started){CTool.btns=[{},{'classgroup':'全班/小组','praise':'表扬','lock':'锁屏','back':'返回'}]}else{CTool.btns=[{},{'start':'开始上课','back':'返回'}]}CTool.show_btns();(!cancel_back)&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom)}};function CKW_tool_c_tongji(){var me=this;this.go=function(params,cancel_back){switch(params.resource_type){case"courseware":case"qti_exam":case"qti_question":kw_go({'c':'CTongji','a':'start_qti','course_resource_id':params.course_resource_id,'dcom_entity_id':params.entity_id});break;case"graph":kw_go({'c':'CTongji','a':'start_dms','resource_id':params.resource_id});break;case"ivideo":case"icom":kw_go({'c':'CTongji','a':'start_zujian','resource_id':params.resource_id});break;default:alert('未知类型！');break}CTool.d.DOM_STORE[me.dom_id(params)]=params};this.dom_id=function(params){var d={};return dom_id='tongji_'+kw_md5(kw_tojson(d))};this.cdom_id=function(params){var d=params;return dom_id='brush_tongji_'+kw_md5(me.dom_id(params)+kw_tojson(d))};this.show=function(type,params,succ,cancel_back){var dom_isnew=false;var dom_id=me.dom_id(params);if(!$('#main_datas > #'+dom_id).length){dom_isnew=true;$('#main_datas').append('<div id="'+dom_id+'" class="tongji"></div>')}$('#main_datas').show();$('#main_datas > div').hide();$('#main_tools').show();$('#full_container').hide();var dom=$('#'+dom_id).show();if(params.tongji_type=="taoti"){CTool.btns=[{'toolbox':'工具箱','brush':'画笔','student':'学生'},{'prev_question':'上一题','next_question':'下一题','reload':'重新加载','pubresult':'发布答案','back':'返回'}]}else if(params.tongji_type=="dms"){CTool.btns=[{'toolbox':'工具箱','brush':'画笔','student':'学生'},{'back':'返回'}]}else if(params.tongji_type=="single"){CTool.btns=[{'toolbox':'工具箱','brush':'画笔','student':'学生'},{'reload':'重新加载','pubresult':'发布答案','back':'返回'}]}else if(params.tongji_type=="zujian"){CTool.btns=[{'toolbox':'工具箱','brush':'画笔','student':'学生'},{'back':'返回'}]}CTool.show_btns();(!cancel_back&&CTool.d.type!='qtireceive')&&CTool.mos_push(CTool.d.type,CTool.d.get_params());typeof succ=='function'&&succ(dom)}};function CKW_tool_a(){var me=this;this.press_effect=function(){$(this).addClass('btn-on');kw_delay_remove.apply(this,['btn-on'])};this.close_many=function(except){if($.inArray('brush',except||[])==-1){$('#brush_tool').hide();$('#main_brush').hide();$('#bg_brush').hide();$('.bar-icon.icon-brush').removeClass('btn-on')}if($.inArray('curtain',except||[])==-1){$('#main_curtain').hide();$('.bar-icon.icon-screen').removeClass('btn-on')}if($.inArray('pulldown',except||[])==-1){$('#main_pulldown').hide();$('.bar-icon.icon-pushscreen').removeClass('btn-on')}if($.inArray('enlarge',except||[])==-1){CTool.a.zoomin.zoom_out()}$('.bar-icon.icon-tools').parent().removeClass('btn-active-'+DApp.toolbar_pos);$('.bar-icon.icon-tools').removeClass('btn-on')};this._toolbox=function(){if($(this).hasClass('btn-active-'+DApp.toolbar_pos)){$(this).removeClass('btn-active-'+DApp.toolbar_pos);$('.bar-icon.icon-tools').removeClass('btn-on')}else{$(this).addClass('btn-active-'+DApp.toolbar_pos);$('.bar-icon.icon-tools').addClass('btn-on')}};this._zoom_in=function(){$('#main_pulldown').hide();CTool.a.zoomin.zoom_toggle()};this._students=function(){CTool.sw('students',{},function(dom){if($('#main_tools .classgroup').attr('is_group')=='yes'){seajs.use('modules/student',function(student){student.loadGroup(dom,function(){})})}else{seajs.use('modules/student',function(student){student.load(dom,function(){})})}})};this._classstat=function(){CTool.c.classstat.go({})};this._platform=function(){CTool.sw('tongji_all',{},function(dom){kw_tpl("tongji/tongji_all.tpl.html",{},function(html){dom.html(html);KW_chart.draw_tongji_all()})})};this._send=function(){switch(CTool.d.type){case"bloswx":var params=CTool.d.get_params();if(params.qti_param){var _params={'resource_id':params.resource_id,'course_resource_id':params.course_resource_id,'resource_type':params.resource_type,'icom_id':HAr.get(params,['qti_param','icom_id']),'dcom_id':HAr.get(params,['qti_param','dcom_id']),'entity_id':HAr.get(params,['qti_param','entity_id']),'extra':{'step':1}};CTool.c.qtireceive.go(_params)}else{alert('没有检测到课件中的试题标记!')}break;default:var params=CTool.d.get_params();if(params.resource_type=='qti_exam'){params.icom_id='4629'}if(params.resource_type=='qti_question'){params.icom_id='4629'}CTool.c.qtireceive.go(params);break}};this._viewstat=function(){var params=CTool.d.get_params();CTool.c.tongji.go(params);CTool.api.set_recover({})};this._catalogue=function(){switch(CTool.d.type){case"ebook":if($('.dialog-base .ebook_list').length){$('.dialog-base').empty().removeClass('dialog-mask-white dialog-mask-black')}else{$('.dialog-base').empty().addClass('dialog-mask-white');seajs.use(['modules/ebook'],function(ebook){ebook.list($('.dialog-base'))})}break;case"bloswx":if($('.dialog-base .bloswx_list').length){$('.dialog-base').empty().removeClass('dialog-mask-white dialog-mask-black')}else{$('.dialog-base').empty().addClass('dialog-mask-white');kw_tpl('tool/bloswx_list.tpl.html',{'total':CTool.d.DOM_STORE[CTool.d.dom_id].total},function(html){$('.dialog-base').html(html)})}break}};this._prev=function(){switch(CTool.d.type){case'ebook':CTool.a.ebook.prev();break;case'bloswx':$('#'+CTool.d.dom_id+' iframe')[0].contentWindow.postMessage(kw_tojson({type:'Blos.prevAnimation'}),'*');break}};this._next=function(){switch(CTool.d.type){case'ebook':CTool.a.ebook.next();break;case'bloswx':$('#'+CTool.d.dom_id+' iframe')[0].contentWindow.postMessage(kw_tojson({type:'Blos.nextAnimation'}),'*');break}};this._prev_question=function(){switch(CTool.d.type){case'tongji':CTongji.chart.taoti.previous();break}};this._next_question=function(){switch(CTool.d.type){case'tongji':CTongji.chart.taoti.next();break}};this._pubresult=function(){var params=kw_tojson(CTool.d.get_params());seajs.use('modules/task',function(task){task.sendAnswer(params)})};this._back=function(){var one=CTool.d.STACK_BACKS.pop();if(typeof HAr.get(CTool.c,[one.type,'go'])=='function'){if(CTool.d.type=='tongji'){seajs.use('modules/task',function(task){task.endAnswer(function(){HAr.get(CTool.c,[one.type,'go'])(one.params,true)})})}else{HAr.get(CTool.c,[one.type,'go'])(one.params,true)}}else{CTool.sw(one.type,one.params,null,true)}};this._classgroup=function(){var $o=$(this);if($(this).attr('is_group')=='yes'){console.log('全班');CTool.sw('students',{},function(dom){seajs.use('modules/student',function(student){student.load(dom,function(){$o.attr('is_group','')})})},true)}else{console.log('小组');CTool.sw('students',{},function(dom){seajs.use('modules/student',function(student){student.loadGroup(dom,function(){$($o).attr('is_group','yes')})})},true)}};this._endtest=function(){var params=CTool.d.get_params();CTool.c.tongji.go(params);CTool.api.set_recover({})};this._resend=function(){seajs.use('modules/task',function(task){task.resend()})};this._lock=function(){if($(this).attr('is_lock')=='yes'){$(this).attr('is_lock','');$(this).find('.bar-icon').removeClass('icon-unlock').addClass('icon-lock');$(this).find('span').html('锁屏');seajs.use('modules/command',function(command){command.unlockScreen()})}else{$(this).attr('is_lock','yes');$(this).find('.bar-icon').removeClass('icon-lock').addClass('icon-unlock');$(this).find('span').html('解锁');seajs.use('modules/command',function(command){command.lockScreen()})}};this._praise=function(){console.log('表扬');seajs.use('modules/student',function(student){student.praise()})};this._start=function(){seajs.use('modules/command',function(command){command.classesBegin(function(){if(CTool.d.type=='reslist'){CTool.d.STACK_BACKS=[];CTool.sw(CTool.d.type,CTool.d.get_params(),function(dom){})}else{var one=CTool.d.STACK_BACKS.shift();CTool.d.STACK_BACKS=[];CTool.sw(one.type,one.params,function(dom){})}DApp.started=true;CTool.c.reslist.go({'hour_id':DApp.hour_id})})})};this._end=function(){seajs.use('modules/command',function(command){command.classesEnd(function(){DApp.started=false;DApp.publish_id=null;CTool.sw(CTool.d.type,CTool.d.get_params(),function(dom){CTool.c.reslist.go({'hour_id':DApp.hour_id})})})})};this._reload=function(){}};function CKW_tool_api(){var me=this;this.urls={'CourseHourPageLocation':['dist','?q=json/ebag/SetPublish/CourseHourPageLocation&info=$info^']};this.set_recover=function(recover_params){if(DApp.publish_id){var info={'course_hour_publish_id':DApp.publish_id,'recover_params':recover_params};kw_api(me.urls['CourseHourPageLocation'],{'info':kw_tojson(info)},{},function(j){},function(){alert('设置恢复上课参数时接口出错！')})}};this.ebook_exist=function(){if(DApp.ebook_exist==null){seajs.use('modules/ebook',function(ebook){ebook.exist(DApp.class_info.book_id,function(ebook_exist){DApp.ebook_exist=ebook_exist})})}}};function CKW_tool_d(){var me=this;this.type='';this.dom_id='';this.params={};this.STACK_BACKS=[];this.DOM_STORE={};this.get_params=function(dom_id){dom_id=dom_id||CTool.d.dom_id;return HAr.get(CTool.d.DOM_STORE,[CTool.d.dom_id])};this.set_params=function(key,val){CTool.d.DOM_STORE[CTool.d.dom_id][key]=val}};function CKW_tool_extra(){var me=this;this.ebook_ready=function(params){seajs.use(['modules/ebook'],function(ebook){ebook.ready(params)})};this.ebook_pageturn_succ=function(params){CTool.d.DOM_STORE[CTool.d.dom_id].page=params;console.log(params)};this.qti_message=function(extra){if(CTool.d.type=='icom'){CTool.c.icom.set_extra(extra)}}};function CKW_tool(){var me=this;this.sw=function(type,params,succ,cancel_back){if(!$('#main_container').length){$(document.body).prepend("<div id='main_container'></div>")}if(!$('#main_container #main_datas').length){$('#main_container').prepend("<div id='main_datas' class='zoom_in'></div>")}if(!$('#main_container #main_brush').length){$('#main_container').prepend("<div id='main_brush' class='zoom_in'></div>")}if(!$('#main_tools').length){$(document.body).prepend("<div id='main_tools' class='toolbar abs toolbar-right' _tk='CTool.a.close_many();'></div>");kw_tpl('tool/index.tpl.html',{},function(html){$('#main_tools').html(html)})}$('#main_curtain').hide();if(typeof HAr.get(me.c,[type,'show'])=='function'){me.c[type].show(type,params,function(dom,dom_isnew){me.d.type=type;me.d.params=params;me.d.dom_id=dom.attr('id');typeof succ=='function'&&succ(dom,dom_isnew)},cancel_back)}};this.show_btns=function(){$('#main_tools >> .one').hide();var n=0;for(var i in me.btns[0]){$('#main_tools .one.'+i).show();n++}if(n==0){}var pre=null;for(var i in me.btns[1]){$('#main_tools .one.'+i).show();if(pre){pre.after($('#main_tools .one.'+i))}pre=$('#main_tools .one.'+i)}var innerWidth=window.innerWidth;var innerHeight=window.innerHeight;var toolbarBoxWidth=$(".toolbar-box:eq(0)>div:visible").length*70;if(DApp.toolbar_pos=="left"){var toolbarBoxPos={"left":0,"top":(innerHeight-toolbarBoxWidth)/2,"right":"auto","bottom":"auto"}}else if(DApp.toolbar_pos=="top"){var toolbarBoxPos={"left":(innerWidth-toolbarBoxWidth)/2,"top":0,"right":"auto","bottom":"auto"}}else if(DApp.toolbar_pos=="right"){var toolbarBoxPos={"left":0,"top":(innerHeight-toolbarBoxWidth)/2,"right":"auto","bottom":"auto"}}else if(DApp.toolbar_pos=="bottom"){var toolbarBoxPos={"left":(innerWidth-toolbarBoxWidth)/2,"top":0,"right":"auto","bottom":"auto"}}else{var toolbarBoxPos={"left":0,"top":(innerHeight-toolbarBoxWidth)/2,"right":"auto","bottom":"auto"}}$(".toolbar-box:eq(0)").css(toolbarBoxPos)};this.mos_push=function(type,params){me.d.STACK_BACKS.push({'type':type,'params':params})};this.init=function(){_instance('CTool.d');_instance('CTool.extra');_instance('CTool.a');_instance('CTool.api');this.c=new function(){};_instance('CTool.a.bloswx');_instance('CTool.a.brush');_instance('CTool.a.brush.bg');_instance('CTool.a.brush.gli');_instance('CTool.a.curtain');_instance('CTool.a.ebook');_instance('CTool.a.pulldown');_instance('CTool.a.zoomin');_instance('CTool.c.bloswx');_instance('CTool.c.classstat');_instance('CTool.c.ebook');_instance('CTool.c.icom');_instance('CTool.c.qtireceive');_instance('CTool.c.reslist');_instance('CTool.c.selclass');_instance('CTool.c.students');_instance('CTool.c.tongji')};this.btns=[{'toolbox':'工具箱','brush':'画笔'},{'student':'学生','ebook':'电子课本','classstat':'课堂统计','platform':'备课平台','send':'发送','viewstat':'查看统计','back':'返回','catalogue':'目录','prev':'上页','next':'下页','prev_question':'上一题','next_question':'下一题','reload':'重新加载','pubresult':'发布答案','endtest':'结束练习','resend':'重发','classgroup':'全班/小组','praise':'表扬','lock':'锁屏','start':'开始上课','end':'结束上课'}]};function CKW_toolbarmove_a(){var me=this;this.on_top=function(){$('#main_tools').removeClass('toolbar-top toolbar-right toolbar-bottom toolbar-left').addClass('toolbar-top');$('#main_container').css({'top':'60px','right':0,'bottom':0,'left':0});$('.toolbarmove').hide();$('.toolbarmove.BR').show();$('.toolbarmove.BL').show();DApp.toolbar_pos='top';me._repos_subemenu('top');me._reset_curston({'top':'60px'})};this.on_right=function(){$('#main_tools').removeClass('toolbar-top toolbar-right toolbar-bottom toolbar-left').addClass('toolbar-right');$('#main_container').css({'top':0,'right':'60px','bottom':0,'left':0});$('.toolbarmove').hide();$('.toolbarmove.TL').show();$('.toolbarmove.BL').show();DApp.toolbar_pos='right';me._repos_subemenu('right');me._reset_curston({'right':'60px'})};this.on_bottom=function(){$('#main_tools').removeClass('toolbar-top toolbar-right toolbar-bottom toolbar-left').addClass('toolbar-bottom');$('#main_container').css({'top':0,'right':0,'bottom':'60px','left':0});$('.toolbarmove').hide();$('.toolbarmove.TL').show();$('.toolbarmove.TR').show();DApp.toolbar_pos='bottom';me._repos_subemenu('bottom');me._reset_curston({'bottom':'60px'})};this.on_left=function(){$('#main_tools').removeClass('toolbar-top toolbar-right toolbar-bottom toolbar-left').addClass('toolbar-left');$('#main_container').css({'top':0,'right':0,'bottom':0,'left':'60px'});$('.toolbarmove').hide();$('.toolbarmove.TR').show();$('.toolbarmove.BR').show();DApp.toolbar_pos='left';me._repos_subemenu('left');me._reset_curston({'left':'60px'})};this._repos_subemenu=function(pos){if($('#main_tools .toolbox').hasClass('btn-active-top')||$('#main_tools .toolbox').hasClass('btn-active-right')||$('#main_tools .toolbox').hasClass('btn-active-bottom')||$('#main_tools .toolbox').hasClass('btn-active-left')){$('#main_tools .toolbox').removeClass('btn-active-top btn-active-right btn-active-bottom btn-active-left');$('#main_tools .toolbox').addClass('btn-active-'+pos)}};this._reset_curston=function(css){$('#main_curtain').css({'top':0,'right':0,'bottom':0,'left':0});$('#main_curtain .in').css({'top':0,'right':0,'bottom':0,'left':0});$('#main_curtain').css(css);CTool.show_btns()}}function CKW_toolbarmove(){var me=this;this.on=function(){_instance('CToolbarmove.a')};this.index=function(){me.on();kw_tpl('toolbarmove/index.tpl.html',{},function(html){$('#toolbarmove').html(html).show();if($('#main_tools').hasClass('toolbar-top')){$('#toolbarmove .top').hide()}if($('#main_tools').hasClass('toolbar-right')){$('#toolbarmove .right').hide()}if($('#main_tools').hasClass('toolbar-bottom')){$('#toolbarmove .bottom').hide()}if($('#main_tools').hasClass('toolbar-left')){$('#toolbarmove .left').hide()}})}}